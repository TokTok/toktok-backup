{
    "_links": {
        "comments": {
            "href": "https://api.github.com/repos/TokTok/c-toxcore/issues/2147/comments"
        },
        "commits": {
            "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147/commits"
        },
        "html": {
            "href": "https://github.com/TokTok/c-toxcore/pull/2147"
        },
        "issue": {
            "href": "https://api.github.com/repos/TokTok/c-toxcore/issues/2147"
        },
        "review_comment": {
            "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments{/number}"
        },
        "review_comments": {
            "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147/comments"
        },
        "self": {
            "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
        },
        "statuses": {
            "href": "https://api.github.com/repos/TokTok/c-toxcore/statuses/e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2"
        }
    },
    "active_lock_reason": null,
    "additions": 2755,
    "assignee": {
        "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
        "events_url": "https://api.github.com/users/zugz/events{/privacy}",
        "followers_url": "https://api.github.com/users/zugz/followers",
        "following_url": "https://api.github.com/users/zugz/following{/other_user}",
        "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zugz",
        "id": 590069,
        "login": "zugz",
        "node_id": "MDQ6VXNlcjU5MDA2OQ==",
        "organizations_url": "https://api.github.com/users/zugz/orgs",
        "received_events_url": "https://api.github.com/users/zugz/received_events",
        "repos_url": "https://api.github.com/users/zugz/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zugz",
        "user_view_type": "public"
    },
    "assignees": [
        {
            "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
            "events_url": "https://api.github.com/users/zugz/events{/privacy}",
            "followers_url": "https://api.github.com/users/zugz/followers",
            "following_url": "https://api.github.com/users/zugz/following{/other_user}",
            "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/zugz",
            "id": 590069,
            "login": "zugz",
            "node_id": "MDQ6VXNlcjU5MDA2OQ==",
            "organizations_url": "https://api.github.com/users/zugz/orgs",
            "received_events_url": "https://api.github.com/users/zugz/received_events",
            "repos_url": "https://api.github.com/users/zugz/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/zugz",
            "user_view_type": "public"
        }
    ],
    "author_association": "MEMBER",
    "auto_merge": null,
    "base": {
        "label": "TokTok:master",
        "ref": "master",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/TokTok/c-toxcore/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/TokTok/c-toxcore/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/TokTok/c-toxcore/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/TokTok/c-toxcore/branches{/branch}",
            "clone_url": "https://github.com/TokTok/c-toxcore.git",
            "collaborators_url": "https://api.github.com/repos/TokTok/c-toxcore/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/TokTok/c-toxcore/comments{/number}",
            "commits_url": "https://api.github.com/repos/TokTok/c-toxcore/commits{/sha}",
            "compare_url": "https://api.github.com/repos/TokTok/c-toxcore/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/TokTok/c-toxcore/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/TokTok/c-toxcore/contributors",
            "created_at": "2016-07-06T08:15:22Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/TokTok/c-toxcore/deployments",
            "description": "The future of online communications.",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/TokTok/c-toxcore/downloads",
            "events_url": "https://api.github.com/repos/TokTok/c-toxcore/events",
            "fork": true,
            "forks": 292,
            "forks_count": 292,
            "forks_url": "https://api.github.com/repos/TokTok/c-toxcore/forks",
            "full_name": "TokTok/c-toxcore",
            "git_commits_url": "https://api.github.com/repos/TokTok/c-toxcore/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/TokTok/c-toxcore/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/TokTok/c-toxcore/git/tags{/sha}",
            "git_url": "git://github.com/TokTok/c-toxcore.git",
            "has_discussions": false,
            "has_downloads": false,
            "has_issues": true,
            "has_pages": false,
            "has_projects": false,
            "has_wiki": false,
            "homepage": "https://tox.chat",
            "hooks_url": "https://api.github.com/repos/TokTok/c-toxcore/hooks",
            "html_url": "https://github.com/TokTok/c-toxcore",
            "id": 62703642,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/TokTok/c-toxcore/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/TokTok/c-toxcore/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/TokTok/c-toxcore/issues{/number}",
            "keys_url": "https://api.github.com/repos/TokTok/c-toxcore/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/TokTok/c-toxcore/labels{/name}",
            "language": "C",
            "languages_url": "https://api.github.com/repos/TokTok/c-toxcore/languages",
            "license": {
                "key": "gpl-3.0",
                "name": "GNU General Public License v3.0",
                "node_id": "MDc6TGljZW5zZTk=",
                "spdx_id": "GPL-3.0",
                "url": "https://api.github.com/licenses/gpl-3.0"
            },
            "merges_url": "https://api.github.com/repos/TokTok/c-toxcore/merges",
            "milestones_url": "https://api.github.com/repos/TokTok/c-toxcore/milestones{/number}",
            "mirror_url": null,
            "name": "c-toxcore",
            "node_id": "MDEwOlJlcG9zaXRvcnk2MjcwMzY0Mg==",
            "notifications_url": "https://api.github.com/repos/TokTok/c-toxcore/notifications{?since,all,participating}",
            "open_issues": 210,
            "open_issues_count": 210,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/17427091?v=4",
                "events_url": "https://api.github.com/users/TokTok/events{/privacy}",
                "followers_url": "https://api.github.com/users/TokTok/followers",
                "following_url": "https://api.github.com/users/TokTok/following{/other_user}",
                "gists_url": "https://api.github.com/users/TokTok/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/TokTok",
                "id": 17427091,
                "login": "TokTok",
                "node_id": "MDEyOk9yZ2FuaXphdGlvbjE3NDI3MDkx",
                "organizations_url": "https://api.github.com/users/TokTok/orgs",
                "received_events_url": "https://api.github.com/users/TokTok/received_events",
                "repos_url": "https://api.github.com/users/TokTok/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/TokTok/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/TokTok/subscriptions",
                "type": "Organization",
                "url": "https://api.github.com/users/TokTok",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls{/number}",
            "pushed_at": "2025-01-24T18:18:40Z",
            "releases_url": "https://api.github.com/repos/TokTok/c-toxcore/releases{/id}",
            "size": 25245,
            "ssh_url": "git@github.com:TokTok/c-toxcore.git",
            "stargazers_count": 2329,
            "stargazers_url": "https://api.github.com/repos/TokTok/c-toxcore/stargazers",
            "statuses_url": "https://api.github.com/repos/TokTok/c-toxcore/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/TokTok/c-toxcore/subscribers",
            "subscription_url": "https://api.github.com/repos/TokTok/c-toxcore/subscription",
            "svn_url": "https://github.com/TokTok/c-toxcore",
            "tags_url": "https://api.github.com/repos/TokTok/c-toxcore/tags",
            "teams_url": "https://api.github.com/repos/TokTok/c-toxcore/teams",
            "topics": [
                "cryptography",
                "encryption",
                "network",
                "p2p",
                "security",
                "toxcore"
            ],
            "trees_url": "https://api.github.com/repos/TokTok/c-toxcore/git/trees{/sha}",
            "updated_at": "2025-01-24T22:05:30Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore",
            "visibility": "public",
            "watchers": 2329,
            "watchers_count": 2329,
            "web_commit_signoff_required": false
        },
        "sha": "dec1399776fcd1a89d78588b77ddd1c44a9bf635",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/17427091?v=4",
            "events_url": "https://api.github.com/users/TokTok/events{/privacy}",
            "followers_url": "https://api.github.com/users/TokTok/followers",
            "following_url": "https://api.github.com/users/TokTok/following{/other_user}",
            "gists_url": "https://api.github.com/users/TokTok/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/TokTok",
            "id": 17427091,
            "login": "TokTok",
            "node_id": "MDEyOk9yZ2FuaXphdGlvbjE3NDI3MDkx",
            "organizations_url": "https://api.github.com/users/TokTok/orgs",
            "received_events_url": "https://api.github.com/users/TokTok/received_events",
            "repos_url": "https://api.github.com/users/TokTok/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/TokTok/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/TokTok/subscriptions",
            "type": "Organization",
            "url": "https://api.github.com/users/TokTok",
            "user_view_type": "public"
        }
    },
    "body": "This is the \"server-side\" part of the new friend-finding. Nodes store small amounts of data on request, and support searching for it.\n\n<!-- Reviewable:start -->\n---\nThis change is [<img src=\"https://reviewable.io/review_button.svg\" height=\"34\" align=\"absmiddle\" alt=\"Reviewable\"/>](https://reviewable.io/reviews/toktok/c-toxcore/2147)\n<!-- Reviewable:end -->\n",
    "changed_files": 48,
    "closed_at": "2022-04-03T14:00:00Z",
    "comment_data": [
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825429321"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429321"
                }
            },
            "author_association": "MEMBER",
            "body": "The last argument should be bool (`false`).",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-13T10:53:23Z",
            "diff_hunk": "@@ -527,6 +530,34 @@ void onion_response_handler(TCP_Client_Connection *con, tcp_onion_response_cb *o\n     con->onion_callback_object = object;\n }\n \n+/** @retval 1 on success.\n+ * @retval 0 if could not send packet.\n+ * @retval -1 on failure (connection must be killed).\n+ */\n+int send_forward_request_tcp(const Logger *logger, TCP_Client_Connection *con, const IP_Port *dest, const uint8_t *data, uint16_t length)\n+{\n+    if (length > MAX_FORWARD_DATA_SIZE) {\n+        return -1;\n+    }\n+\n+    VLA(uint8_t, packet, 1 + MAX_PACKED_IPPORT_SIZE + length);\n+    packet[0] = TCP_PACKET_FORWARD_REQUEST;\n+    const int ipport_length = pack_ip_port(logger, packet + 1, MAX_PACKED_IPPORT_SIZE, dest);\n+\n+    if (ipport_length == -1) {\n+        return 0;\n+    }\n+\n+    memcpy(packet + 1 + ipport_length, data, length);\n+    return write_packet_TCP_secure_connection(logger, &con->con, packet, 1 + ipport_length + length, 0);",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825429321",
            "id": 825429321,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4xMw1J",
            "original_commit_id": "4705293ae95f7a338e04e3b5f02662276329439b",
            "original_line": 552,
            "original_position": 33,
            "original_start_line": null,
            "path": "toxcore/TCP_client.c",
            "position": null,
            "pull_request_review_id": 908122220,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429321/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-13T11:19:16Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429321",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825429347"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429347"
                }
            },
            "author_association": "MEMBER",
            "body": "Same here (bool).",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-13T10:53:32Z",
            "diff_hunk": "@@ -591,6 +618,42 @@ static int handle_onion_recv_1(void *object, const IP_Port *dest, const uint8_t\n     return 0;\n }\n \n+non_null()\n+static bool handle_forward_reply_tcp(void *object, const uint8_t *sendback_data, uint16_t sendback_data_len,\n+                                     const uint8_t *data, uint16_t length)\n+{\n+    TCP_Server *tcp_server = (TCP_Server *)object;\n+\n+    if (sendback_data_len != 1 + sizeof(uint32_t) + sizeof(uint64_t)) {\n+        return false;\n+    }\n+\n+    if (*sendback_data != SENDBACK_TCP) {\n+        return false;\n+    }\n+\n+    uint32_t con_id;\n+    uint64_t identifier;\n+    net_unpack_u32(sendback_data + 1, &con_id);\n+    net_unpack_u64(sendback_data + 1 + sizeof(uint32_t), &identifier);\n+\n+    if (con_id >= tcp_server->size_accepted_connections) {\n+        return false;\n+    }\n+\n+    TCP_Secure_Connection *con = &tcp_server->accepted_connection_array[con_id];\n+\n+    if (con->identifier != identifier) {\n+        return false;\n+    }\n+\n+    VLA(uint8_t, packet, 1 + length);\n+    memcpy(packet + 1, data, length);\n+    packet[0] = TCP_PACKET_FORWARDING;\n+\n+    return (write_packet_TCP_secure_connection(tcp_server->logger, &con->con, packet, SIZEOF_VLA(packet), 0) == 1);",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825429347",
            "id": 825429347,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4xMw1j",
            "original_commit_id": "4705293ae95f7a338e04e3b5f02662276329439b",
            "original_line": 654,
            "original_position": 107,
            "original_start_line": null,
            "path": "toxcore/TCP_server.c",
            "position": null,
            "pull_request_review_id": 908122220,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429347/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-13T11:19:16Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429347",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825429547"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429547"
                }
            },
            "author_association": "MEMBER",
            "body": "`previous` is of type `bool` and can't be subtracted from a `uint64_t`. Use `?:` to turn it back into an int.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-13T10:54:40Z",
            "diff_hunk": "@@ -0,0 +1,40 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2021 The TokTok team.\n+ */\n+#include \"timed_auth.h\"\n+\n+#include <string.h>\n+\n+#include \"ccompat.h\"\n+\n+static void create_timed_auth_to_hash(const Mono_Time *mono_time, uint16_t timeout, bool previous, const uint8_t *data,\n+                                      uint16_t length, uint8_t *to_hash)\n+{\n+    const uint64_t t = (mono_time_get(mono_time) / timeout) - previous;",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825429547",
            "id": 825429547,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4xMw4r",
            "original_commit_id": "4705293ae95f7a338e04e3b5f02662276329439b",
            "original_line": 13,
            "original_position": 13,
            "original_start_line": null,
            "path": "toxcore/timed_auth.c",
            "position": null,
            "pull_request_review_id": 908122220,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429547/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-13T11:19:16Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429547",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825429659"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429659"
                }
            },
            "author_association": "MEMBER",
            "body": "Parameter `previous` is of type `bool`, but passing `uint8_t` here. Use `!= 0` or `> 0` to turn `i` into a `bool`.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-13T10:55:33Z",
            "diff_hunk": "@@ -0,0 +1,40 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2021 The TokTok team.\n+ */\n+#include \"timed_auth.h\"\n+\n+#include <string.h>\n+\n+#include \"ccompat.h\"\n+\n+static void create_timed_auth_to_hash(const Mono_Time *mono_time, uint16_t timeout, bool previous, const uint8_t *data,\n+                                      uint16_t length, uint8_t *to_hash)\n+{\n+    const uint64_t t = (mono_time_get(mono_time) / timeout) - previous;\n+    memcpy(to_hash, &t, sizeof(t));\n+    memcpy(to_hash + sizeof(t), data, length);\n+}\n+\n+void generate_timed_auth(const Mono_Time *mono_time, uint16_t timeout, const uint8_t *key,\n+                         const uint8_t *data, uint16_t length, uint8_t *timed_auth)\n+{\n+    VLA(uint8_t, to_hash, sizeof(uint64_t) + length);\n+    create_timed_auth_to_hash(mono_time, timeout, false, data, length, to_hash);\n+    crypto_hmac(timed_auth, key, to_hash, SIZEOF_VLA(to_hash));\n+}\n+\n+bool check_timed_auth(const Mono_Time *mono_time, uint16_t timeout, const uint8_t *key, const uint8_t *data,\n+                      uint16_t length, const uint8_t *timed_auth)\n+{\n+    VLA(uint8_t, to_hash, sizeof(uint64_t) + length);\n+\n+    for (uint8_t i = 0; i < 2; ++i) {\n+        create_timed_auth_to_hash(mono_time, timeout, i, data, length, to_hash);",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825429659",
            "id": 825429659,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4xMw6b",
            "original_commit_id": "4705293ae95f7a338e04e3b5f02662276329439b",
            "original_line": 32,
            "original_position": 32,
            "original_start_line": null,
            "path": "toxcore/timed_auth.c",
            "position": null,
            "pull_request_review_id": 908122220,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429659/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-13T11:19:16Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429659",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825429755"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429755"
                }
            },
            "author_association": "MEMBER",
            "body": "Prefer doxygen-style comments (they are parsed more strictly and benefit from decl/defn checks, ensuring decls have the same comment as defns).",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-13T10:56:08Z",
            "diff_hunk": "@@ -0,0 +1,24 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2021 The TokTok team.\n+ */\n+#ifndef C_TOXCORE_TOXCORE_TIMED_AUTH_H\n+#define C_TOXCORE_TOXCORE_TIMED_AUTH_H\n+\n+#include \"crypto_core.h\"\n+#include \"mono_time.h\"\n+\n+#define TIMED_AUTH_SIZE CRYPTO_HMAC_SIZE\n+\n+/* Put timed authentication code of data in timed_auth. */",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825429755",
            "id": 825429755,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4xMw77",
            "original_commit_id": "4705293ae95f7a338e04e3b5f02662276329439b",
            "original_line": 12,
            "original_position": 12,
            "original_start_line": null,
            "path": "toxcore/timed_auth.h",
            "position": null,
            "pull_request_review_id": 908122220,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429755/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-13T11:19:16Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825429755",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825431638"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825431638"
                }
            },
            "author_association": "MEMBER",
            "body": "Maybe too late, but have you considered using msgpack for the new packets?",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-13T11:12:09Z",
            "diff_hunk": "@@ -71,6 +71,17 @@ typedef enum Net_Packet_Type {\n     NET_PACKET_ONION_RECV_2         = 0x8d,\n     NET_PACKET_ONION_RECV_1         = 0x8e,\n \n+    NET_PACKET_FORWARD_REQUEST      = 0x90,",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825431638",
            "id": 825431638,
            "line": 173,
            "node_id": "PRRC_kwDOA7zIGs4xMxZW",
            "original_commit_id": "4705293ae95f7a338e04e3b5f02662276329439b",
            "original_line": 173,
            "original_position": 26,
            "original_start_line": null,
            "path": "toxcore/network.h",
            "position": 26,
            "pull_request_review_id": 908122220,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825431638/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-13T11:19:16Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825431638",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825432250"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825432250"
                }
            },
            "author_association": "MEMBER",
            "body": "* success if now - generation_time <= timeout\r\n* failure if now - generation_time >= timeout * 2\r\n\r\nWhat happens if it's in between?",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-13T11:17:33Z",
            "diff_hunk": "@@ -0,0 +1,24 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2021 The TokTok team.\n+ */\n+#ifndef C_TOXCORE_TOXCORE_TIMED_AUTH_H\n+#define C_TOXCORE_TOXCORE_TIMED_AUTH_H\n+\n+#include \"crypto_core.h\"\n+#include \"mono_time.h\"\n+\n+#define TIMED_AUTH_SIZE CRYPTO_HMAC_SIZE\n+\n+/* Put timed authentication code of data in timed_auth. */\n+void generate_timed_auth(const Mono_Time *mono_time, uint16_t timeout, const uint8_t *key,\n+                         const uint8_t *data, uint16_t length, uint8_t *timed_auth);\n+\n+/* Check timed_auth. This succeeds if timed_auth was generated by\n+ * generate_timed_auth at most timeout seconds ago, and fails if at least\n+ * `2*timeout` seconds ago.",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r825432250",
            "id": 825432250,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4xMxi6",
            "original_commit_id": "4705293ae95f7a338e04e3b5f02662276329439b",
            "original_line": 18,
            "original_position": 18,
            "original_start_line": null,
            "path": "toxcore/timed_auth.h",
            "position": null,
            "pull_request_review_id": 908122220,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825432250/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-13T11:19:16Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/825432250",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r830474776"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/830474776"
                }
            },
            "author_association": "MEMBER",
            "body": "no",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-19T11:42:02Z",
            "diff_hunk": "@@ -71,6 +71,17 @@ typedef enum Net_Packet_Type {\n     NET_PACKET_ONION_RECV_2         = 0x8d,\n     NET_PACKET_ONION_RECV_1         = 0x8e,\n \n+    NET_PACKET_FORWARD_REQUEST      = 0x90,",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r830474776",
            "id": 830474776,
            "in_reply_to_id": 825431638,
            "line": 173,
            "node_id": "PRRC_kwDOA7zIGs4xgAoY",
            "original_commit_id": "4705293ae95f7a338e04e3b5f02662276329439b",
            "original_line": 173,
            "original_position": 26,
            "original_start_line": null,
            "path": "toxcore/network.h",
            "position": 26,
            "pull_request_review_id": 914995780,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/830474776/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-19T11:42:02Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/830474776",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835745353"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835745353"
                }
            },
            "author_association": "MEMBER",
            "body": "This reads as \"packet is a single uint8_t that I'm setting here\". `packet[0] = NET...` may be a bit clearer. I realise a lot of your code does `*packet = val`, but this particular one is followed by `packet[1]`, and packet isn't incremented, so it makes sense here.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-26T09:51:54Z",
            "diff_hunk": "@@ -0,0 +1,377 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#include \"forwarding.h\"\n+\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"DHT.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+\n+struct Forwarding {\n+    const Logger *log;\n+    DHT *dht;\n+    Mono_Time *mono_time;\n+    Networking_Core *net;\n+\n+    uint8_t hmac_key[CRYPTO_HMAC_KEY_SIZE];\n+\n+    forward_reply_cb *forward_reply_callback;\n+    void *forward_reply_callback_object;\n+\n+    forwarded_request_cb *forwarded_request_callback;\n+    void *forwarded_request_callback_object;\n+\n+    forwarded_response_cb *forwarded_response_callback;\n+    void *forwarded_response_callback_object;\n+};\n+\n+DHT *forwarding_get_dht(Forwarding *forwarding)\n+{\n+    return forwarding->dht;\n+}\n+\n+#define SENDBACK_TIMEOUT 3600\n+\n+bool send_forward_request(Networking_Core *net, const IP_Port *forwarder,\n+                          const uint8_t *chain_keys, uint16_t chain_length,\n+                          const uint8_t *data, uint16_t data_length)\n+{\n+    const uint16_t len = forward_chain_packet_size(chain_length, data_length);\n+    VLA(uint8_t, packet, len);\n+\n+    return create_forward_chain_packet(chain_keys, chain_length, data, data_length, packet)\n+           && sendpacket(net, forwarder, packet, len) == len;\n+}\n+\n+uint16_t forward_chain_packet_size(uint16_t chain_length, uint16_t data_length)\n+{\n+    return chain_length * (1 + CRYPTO_PUBLIC_KEY_SIZE) + data_length;\n+}\n+\n+bool create_forward_chain_packet(const uint8_t *chain_keys, uint16_t chain_length,\n+                                 const uint8_t *data, uint16_t data_length,\n+                                 uint8_t *packet)\n+{\n+    if (chain_length == 0 || chain_length > MAX_FORWARD_CHAIN_LENGTH\n+            || data_length > MAX_FORWARD_DATA_SIZE) {\n+        return false;\n+    }\n+\n+    uint16_t i = 0;\n+\n+    for (uint16_t j = 0; j < chain_length; ++j) {\n+        packet[i] = NET_PACKET_FORWARD_REQUEST;\n+        ++i;\n+        memcpy(packet + i, chain_keys + j * CRYPTO_PUBLIC_KEY_SIZE, CRYPTO_PUBLIC_KEY_SIZE);\n+        i += CRYPTO_PUBLIC_KEY_SIZE;\n+    }\n+\n+    memcpy(packet + i, data, data_length);\n+    return true;\n+}\n+\n+non_null()\n+static uint16_t forwarding_packet_length(uint16_t sendback_data_len, uint16_t data_length)\n+{\n+    const uint16_t sendback_len = sendback_data_len == 0 ? 0 : TIMED_AUTH_SIZE + sendback_data_len;\n+    return 1 + 1 + sendback_len + data_length;\n+}\n+\n+non_null(1, 4, 6) nullable(2)\n+static bool create_forwarding_packet(const Forwarding *forwarding,\n+                                     const uint8_t *sendback_data, uint16_t sendback_data_len,\n+                                     const uint8_t *data, uint16_t length,\n+                                     uint8_t *packet)\n+{\n+    *packet = NET_PACKET_FORWARDING;",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835745353",
            "id": 835745353,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x0HZJ",
            "original_commit_id": "372df7fe70c7577641febf59d697716a5820b0ef",
            "original_line": 90,
            "original_position": 90,
            "original_start_line": null,
            "path": "toxcore/forwarding.c",
            "position": null,
            "pull_request_review_id": 922301548,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835745353/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-26T22:06:49Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835745353",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816139"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816139"
                }
            },
            "author_association": "MEMBER",
            "body": "Might be worth putting all of these in a struct and using an array of that struct.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-26T21:47:01Z",
            "diff_hunk": "@@ -0,0 +1,318 @@\n+/*\n+ * Copyright © 2019 The TokTok team.\n+ *\n+ * This file is part of Tox, the free peer to peer instant messenger.\n+ *\n+ * Tox is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Tox is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Tox.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+#ifdef HAVE_CONFIG_H\n+#include \"config.h\"\n+#endif\n+\n+#include <assert.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"../toxcore/tox.h\"\n+#include \"../toxcore/announce.h\"\n+#include \"../testing/misc_tools.h\"\n+#include \"../toxcore/mono_time.h\"\n+#include \"../toxcore/forwarding.h\"\n+#include \"../toxcore/net_crypto.h\"\n+#include \"../toxcore/util.h\"\n+#include \"auto_test_support.h\"\n+#include \"check_compat.h\"\n+\n+#ifndef USE_IPV6\n+#define USE_IPV6 1\n+#endif\n+\n+static inline IP get_loopback(void)\n+{\n+    IP ip;\n+#if USE_IPV6\n+    ip.family = net_family_ipv6;\n+    ip.ip.v6 = get_ip6_loopback();\n+#else\n+    ip.family = net_family_ipv4;\n+    ip.ip.v4 = get_ip4_loopback();\n+#endif\n+    return ip;\n+}\n+\n+#define NUM_FORWARDER 20\n+#define NUM_FORWARDER_TCP 5\n+#define NUM_FORWARDER_DHT (NUM_FORWARDER - NUM_FORWARDER_TCP)\n+#define NUM_FORWARDING_ITERATIONS 1\n+#define FORWARD_SEND_INTERVAL 2\n+#define FORWARDER_TCP_RELAY_PORT 36570\n+#define FORWARDING_BASE_PORT 36571\n+\n+typedef struct Test_Data {\n+    Networking_Core *net;\n+    uint32_t send_back;\n+    uint64_t sent;\n+    bool returned;\n+} Test_Data;\n+\n+static void test_forwarded_request_cb(void *object, const IP_Port *forwarder,\n+                                      const uint8_t *sendback, uint16_t sendback_length,\n+                                      const uint8_t *data, uint16_t length, void *userdata)\n+{\n+    Test_Data *test_data = (Test_Data *)object;\n+    uint8_t *index = (uint8_t *)userdata;\n+\n+    if (length != 12 || memcmp(\"hello:  \", data, 8) != 0) {\n+        printf(\"[%u] got unexpected data of length %d\\n\", *index, length);\n+        return;\n+    }\n+\n+    uint8_t reply[12];\n+    memcpy(reply, \"reply:  \", 8);\n+    memcpy(reply + 8, data + 8, 4);\n+    ck_assert_msg(forward_reply(test_data->net, forwarder, sendback, sendback_length, reply, 12),\n+                  \"[%u] forward_reply failed\", *index);\n+}\n+\n+static void test_forwarded_response_cb(void *object,\n+                                       const uint8_t *data, uint16_t length, void *userdata)\n+{\n+    Test_Data *test_data = (Test_Data *)object;\n+    uint8_t *index = (uint8_t *)userdata;\n+\n+    if (length != 12 || memcmp(\"reply:  \", data, 8) != 0) {\n+        printf(\"[%u] got unexpected data of length %d\\n\", *index, length);\n+        return;\n+    }\n+\n+    uint32_t send_back;\n+    net_unpack_u32(data + 8, &send_back);\n+\n+    if (test_data->send_back == send_back) {\n+        test_data->returned = true;\n+    }\n+}\n+\n+static bool all_returned(Test_Data *test_data)\n+{\n+    for (uint32_t i = 0; i < NUM_FORWARDER; ++i) {\n+        if (!test_data[i].returned) {\n+            return false;\n+        }\n+    }\n+\n+    return true;\n+}\n+\n+static void test_forwarding(void)\n+{\n+    assert(sizeof(char) == 1);\n+\n+    uint32_t index[NUM_FORWARDER];",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816139",
            "id": 835816139,
            "line": 161,
            "node_id": "PRRC_kwDOA7zIGs4x0YrL",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 161,
            "original_position": 123,
            "original_start_line": null,
            "path": "auto_tests/forwarding_test.c",
            "position": 161,
            "pull_request_review_id": 922301548,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816139/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-26T22:06:49Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816139",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816320"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816320"
                }
            },
            "author_association": "MEMBER",
            "body": "`/**`",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-26T21:49:00Z",
            "diff_hunk": "@@ -564,22 +565,47 @@ static int rm_connection_index(TCP_Server *tcp_server, TCP_Secure_Connection *co\n     return -1;\n }\n \n+/* Encode con_id and identifier as a custom IP_Port.",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816320",
            "id": 835816320,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x0YuA",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 568,
            "original_position": 12,
            "original_start_line": null,
            "path": "toxcore/TCP_server.c",
            "position": null,
            "pull_request_review_id": 922301548,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816320/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-26T22:06:49Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816320",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816331"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816331"
                }
            },
            "author_association": "MEMBER",
            "body": "`/**`",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-26T21:49:07Z",
            "diff_hunk": "@@ -564,22 +565,47 @@ static int rm_connection_index(TCP_Server *tcp_server, TCP_Secure_Connection *co\n     return -1;\n }\n \n+/* Encode con_id and identifier as a custom IP_Port.\n+ *\n+ * return ip_port.\n+ */\n+static IP_Port con_id_to_ip_port(uint32_t con_id, uint64_t identifier)\n+{\n+    IP_Port ip_port = {{{0}}};\n+    ip_port.ip.family = net_family_tcp_client;\n+    ip_port.ip.ip.v6.uint32[0] = con_id;\n+    ip_port.ip.ip.v6.uint64[1] = identifier;\n+    return ip_port;\n+\n+}\n+\n+/* Decode ip_port created by con_id_to_ip_port to con_id.",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816331",
            "id": 835816331,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x0YuL",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 582,
            "original_position": 26,
            "original_start_line": null,
            "path": "toxcore/TCP_server.c",
            "position": null,
            "pull_request_review_id": 922301548,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816331/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-26T22:06:49Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816331",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816338"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816338"
                }
            },
            "author_association": "MEMBER",
            "body": "Remove empty line.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-26T21:49:15Z",
            "diff_hunk": "@@ -564,22 +565,47 @@ static int rm_connection_index(TCP_Server *tcp_server, TCP_Secure_Connection *co\n     return -1;\n }\n \n+/* Encode con_id and identifier as a custom IP_Port.\n+ *\n+ * return ip_port.\n+ */\n+static IP_Port con_id_to_ip_port(uint32_t con_id, uint64_t identifier)\n+{\n+    IP_Port ip_port = {{{0}}};\n+    ip_port.ip.family = net_family_tcp_client;\n+    ip_port.ip.ip.v6.uint32[0] = con_id;\n+    ip_port.ip.ip.v6.uint64[1] = identifier;\n+    return ip_port;\n+",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816338",
            "id": 835816338,
            "line": 581,
            "node_id": "PRRC_kwDOA7zIGs4x0YuS",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 581,
            "original_position": 23,
            "original_start_line": null,
            "path": "toxcore/TCP_server.c",
            "position": 23,
            "pull_request_review_id": 922301548,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816338/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-26T22:06:49Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816338",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816655"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816655"
                }
            },
            "author_association": "MEMBER",
            "body": "These should have tests in crypto_core_test.cc.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-26T21:51:34Z",
            "diff_hunk": "@@ -82,6 +92,18 @@ void crypto_sha256(uint8_t *hash, const uint8_t *data, size_t length);\n non_null()\n void crypto_sha512(uint8_t *hash, const uint8_t *data, size_t length);\n \n+/**\n+ * @brief Compute an HMAC authenticator (32 bytes).\n+ */\n+non_null()\n+void crypto_hmac(uint8_t *auth, const uint8_t *key, const uint8_t *data, size_t length);",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816655",
            "id": 835816655,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x0YzP",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 164,
            "original_position": 25,
            "original_start_line": null,
            "path": "toxcore/crypto_core.h",
            "position": null,
            "pull_request_review_id": 922301548,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816655/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-26T22:06:49Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816655",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816696"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816696"
                }
            },
            "author_association": "MEMBER",
            "body": "Remove extra `* `.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-26T21:52:10Z",
            "diff_hunk": "@@ -0,0 +1,644 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2020-2021 The TokTok team.\n+ */\n+\n+/**\n+ * \"Server side\" of the DHT announcements protocol.\n+ * */",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816696",
            "id": 835816696,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x0Yz4",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 7,
            "original_position": 7,
            "original_start_line": null,
            "path": "toxcore/announce.c",
            "position": null,
            "pull_request_review_id": 922301548,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816696/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-26T22:06:49Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816696",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816746"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816746"
                }
            },
            "author_association": "MEMBER",
            "body": "Remove space before `:` (does astyle not do this?).",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-26T21:52:36Z",
            "diff_hunk": "@@ -0,0 +1,644 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2020-2021 The TokTok team.\n+ */\n+\n+/**\n+ * \"Server side\" of the DHT announcements protocol.\n+ * */\n+\n+#include \"announce.h\"\n+\n+#include <assert.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"LAN_discovery.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+#include \"util.h\"\n+\n+uint8_t response_of_request_type(uint8_t request_type)\n+{\n+    switch (request_type) {\n+        case NET_PACKET_DATA_SEARCH_REQUEST :",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816746",
            "id": 835816746,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x0Y0q",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 23,
            "original_position": 23,
            "original_start_line": null,
            "path": "toxcore/announce.c",
            "position": null,
            "pull_request_review_id": 922301548,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816746/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-26T22:06:49Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816746",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816776"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816776"
                }
            },
            "author_association": "MEMBER",
            "body": "`/**`",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-26T21:53:09Z",
            "diff_hunk": "@@ -0,0 +1,644 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2020-2021 The TokTok team.\n+ */\n+\n+/**\n+ * \"Server side\" of the DHT announcements protocol.\n+ * */\n+\n+#include \"announce.h\"\n+\n+#include <assert.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"LAN_discovery.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+#include \"util.h\"\n+\n+uint8_t response_of_request_type(uint8_t request_type)\n+{\n+    switch (request_type) {\n+        case NET_PACKET_DATA_SEARCH_REQUEST :\n+            return NET_PACKET_DATA_SEARCH_RESPONSE;\n+\n+        case NET_PACKET_DATA_RETRIEVE_REQUEST :\n+            return NET_PACKET_DATA_RETRIEVE_RESPONSE;\n+\n+        case NET_PACKET_STORE_ANNOUNCE_REQUEST :\n+            return NET_PACKET_STORE_ANNOUNCE_RESPONSE;\n+\n+        default : {\n+            assert(false);\n+            return NET_PACKET_MAX;\n+        }\n+    }\n+}\n+\n+typedef struct Announce_Entry {\n+    uint64_t store_until;\n+    uint8_t data_public_key[CRYPTO_PUBLIC_KEY_SIZE];\n+    uint8_t *data;\n+    uint32_t length;\n+} Announce_Entry;\n+\n+struct Announcements {\n+    const Logger *log;\n+    Forwarding *forwarding;\n+    Mono_Time *mono_time;\n+    DHT *dht;\n+    Networking_Core *net;\n+    const uint8_t *public_key;\n+    const uint8_t *secret_key;\n+\n+    Shared_Keys shared_keys;\n+    uint8_t hmac_key[CRYPTO_HMAC_KEY_SIZE];\n+\n+    int32_t synch_offset;\n+\n+    uint64_t start_time;\n+\n+    Announce_Entry entries[ANNOUNCE_BUCKETS * ANNOUNCE_BUCKET_SIZE];\n+};\n+\n+void set_synch_offset(Announcements *announce, int32_t synch_offset)\n+{\n+    announce->synch_offset = synch_offset;\n+}\n+\n+/* An entry is considered to be \"deleted\" for the purposes of the protocol\n+ * once it has timed out. */\n+non_null()\n+static bool entry_is_empty(const Announcements *announce, const Announce_Entry *entry)\n+{\n+    return mono_time_get(announce->mono_time) >= entry->store_until;\n+}\n+\n+non_null()\n+static void delete_entry(Announce_Entry *entry)\n+{\n+    entry->store_until = 0;\n+}\n+\n+/* Return bits (at most 8) from pk starting at index as uint8_t */\n+non_null()\n+static uint8_t truncate_pk_at_index(const uint8_t *pk, uint16_t index, uint16_t bits)\n+{\n+    assert(bits < 8);\n+    const uint8_t i = index / 8;\n+    const uint8_t j = index % 8;\n+    return ((uint8_t)((i < CRYPTO_PUBLIC_KEY_SIZE ? pk[i] : 0) << j) >> (8 - bits)) |\n+           ((i + 1 < CRYPTO_PUBLIC_KEY_SIZE ? pk[i + 1] : 0) >> (16 - bits - j));\n+}\n+\n+uint16_t get_bucketnum(const uint8_t *base, const uint8_t *pk)\n+{\n+    const uint16_t index = bit_by_bit_cmp(base, pk);\n+\n+    return truncate_pk_at_index(base, index + 1, ANNOUNCE_BUCKET_PREFIX_LENGTH) ^\n+           truncate_pk_at_index(pk, index + 1, ANNOUNCE_BUCKET_PREFIX_LENGTH);\n+}\n+\n+non_null()\n+static Announce_Entry *bucket_of_key(Announcements *announce, const uint8_t *pk)\n+{\n+    return &announce->entries[get_bucketnum(announce->public_key, pk) * ANNOUNCE_BUCKET_SIZE];\n+}\n+\n+non_null()\n+static Announce_Entry *get_stored(Announcements *announce, const uint8_t *data_public_key)\n+{\n+    Announce_Entry *const bucket = bucket_of_key(announce, data_public_key);\n+\n+    for (uint32_t i = 0; i < ANNOUNCE_BUCKET_SIZE; ++i) {\n+        if (pk_equal(bucket[i].data_public_key, data_public_key)) {\n+            if (entry_is_empty(announce, &bucket[i])) {\n+                break;\n+            }\n+\n+            return &bucket[i];\n+        }\n+    }\n+\n+    return nullptr;\n+}\n+\n+non_null()\n+static const Announce_Entry *bucket_of_key_const(const Announcements *announce, const uint8_t *pk)\n+{\n+    return &announce->entries[get_bucketnum(announce->public_key, pk) * ANNOUNCE_BUCKET_SIZE];\n+}\n+\n+non_null()\n+static const Announce_Entry *get_stored_const(const Announcements *announce, const uint8_t *data_public_key)\n+{\n+    const Announce_Entry *const bucket = bucket_of_key_const(announce, data_public_key);\n+\n+    for (uint32_t i = 0; i < ANNOUNCE_BUCKET_SIZE; ++i) {\n+        if (pk_equal(bucket[i].data_public_key, data_public_key)) {\n+            if (entry_is_empty(announce, &bucket[i])) {\n+                break;\n+            }\n+\n+            return &bucket[i];\n+        }\n+    }\n+\n+    return nullptr;\n+}\n+\n+\n+bool on_stored(const Announcements *announce, const uint8_t *data_public_key,\n+               on_retrieve_cb *on_retrieve_callback, void *object)\n+{\n+    const Announce_Entry *const entry = get_stored_const(announce, data_public_key);\n+\n+    if (entry == nullptr || entry->data == nullptr) {\n+        return false;\n+    }\n+\n+    if (on_retrieve_callback != nullptr) {\n+        on_retrieve_callback(object, entry->data, entry->length);\n+    }\n+\n+    return true;\n+}\n+\n+/* Returns existing entry for this key if it exists, else an empty",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835816776",
            "id": 835816776,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x0Y1I",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 168,
            "original_position": 168,
            "original_start_line": null,
            "path": "toxcore/announce.c",
            "position": null,
            "pull_request_review_id": 922301548,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816776/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-26T22:06:49Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835816776",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835817299"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835817299"
                }
            },
            "author_association": "MEMBER",
            "body": "`i` could have a better name. It's not a loop iterator, but rather a byte offset in the packet.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-26T22:00:02Z",
            "diff_hunk": "@@ -0,0 +1,377 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#include \"forwarding.h\"\n+\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"DHT.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+\n+struct Forwarding {\n+    const Logger *log;\n+    DHT *dht;\n+    Mono_Time *mono_time;\n+    Networking_Core *net;\n+\n+    uint8_t hmac_key[CRYPTO_HMAC_KEY_SIZE];\n+\n+    forward_reply_cb *forward_reply_callback;\n+    void *forward_reply_callback_object;\n+\n+    forwarded_request_cb *forwarded_request_callback;\n+    void *forwarded_request_callback_object;\n+\n+    forwarded_response_cb *forwarded_response_callback;\n+    void *forwarded_response_callback_object;\n+};\n+\n+DHT *forwarding_get_dht(Forwarding *forwarding)\n+{\n+    return forwarding->dht;\n+}\n+\n+#define SENDBACK_TIMEOUT 3600\n+\n+bool send_forward_request(Networking_Core *net, const IP_Port *forwarder,\n+                          const uint8_t *chain_keys, uint16_t chain_length,\n+                          const uint8_t *data, uint16_t data_length)\n+{\n+    const uint16_t len = forward_chain_packet_size(chain_length, data_length);\n+    VLA(uint8_t, packet, len);\n+\n+    return create_forward_chain_packet(chain_keys, chain_length, data, data_length, packet)\n+           && sendpacket(net, forwarder, packet, len) == len;\n+}\n+\n+uint16_t forward_chain_packet_size(uint16_t chain_length, uint16_t data_length)\n+{\n+    return chain_length * (1 + CRYPTO_PUBLIC_KEY_SIZE) + data_length;\n+}\n+\n+bool create_forward_chain_packet(const uint8_t *chain_keys, uint16_t chain_length,\n+                                 const uint8_t *data, uint16_t data_length,\n+                                 uint8_t *packet)\n+{\n+    if (chain_length == 0 || chain_length > MAX_FORWARD_CHAIN_LENGTH\n+            || data_length > MAX_FORWARD_DATA_SIZE) {\n+        return false;\n+    }\n+\n+    uint16_t i = 0;",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835817299",
            "id": 835817299,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x0Y9T",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 64,
            "original_position": 64,
            "original_start_line": null,
            "path": "toxcore/forwarding.c",
            "position": null,
            "pull_request_review_id": 922301548,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835817299/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-26T22:06:49Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835817299",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835817597"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835817597"
                }
            },
            "author_association": "MEMBER",
            "body": "Prefer `[0]` when indexing in array-like objects.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-26T22:02:52Z",
            "diff_hunk": "@@ -0,0 +1,377 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#include \"forwarding.h\"\n+\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"DHT.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+\n+struct Forwarding {\n+    const Logger *log;\n+    DHT *dht;\n+    Mono_Time *mono_time;\n+    Networking_Core *net;\n+\n+    uint8_t hmac_key[CRYPTO_HMAC_KEY_SIZE];\n+\n+    forward_reply_cb *forward_reply_callback;\n+    void *forward_reply_callback_object;\n+\n+    forwarded_request_cb *forwarded_request_callback;\n+    void *forwarded_request_callback_object;\n+\n+    forwarded_response_cb *forwarded_response_callback;\n+    void *forwarded_response_callback_object;\n+};\n+\n+DHT *forwarding_get_dht(Forwarding *forwarding)\n+{\n+    return forwarding->dht;\n+}\n+\n+#define SENDBACK_TIMEOUT 3600\n+\n+bool send_forward_request(Networking_Core *net, const IP_Port *forwarder,\n+                          const uint8_t *chain_keys, uint16_t chain_length,\n+                          const uint8_t *data, uint16_t data_length)\n+{\n+    const uint16_t len = forward_chain_packet_size(chain_length, data_length);\n+    VLA(uint8_t, packet, len);\n+\n+    return create_forward_chain_packet(chain_keys, chain_length, data, data_length, packet)\n+           && sendpacket(net, forwarder, packet, len) == len;\n+}\n+\n+uint16_t forward_chain_packet_size(uint16_t chain_length, uint16_t data_length)\n+{\n+    return chain_length * (1 + CRYPTO_PUBLIC_KEY_SIZE) + data_length;\n+}\n+\n+bool create_forward_chain_packet(const uint8_t *chain_keys, uint16_t chain_length,\n+                                 const uint8_t *data, uint16_t data_length,\n+                                 uint8_t *packet)\n+{\n+    if (chain_length == 0 || chain_length > MAX_FORWARD_CHAIN_LENGTH\n+            || data_length > MAX_FORWARD_DATA_SIZE) {\n+        return false;\n+    }\n+\n+    uint16_t i = 0;\n+\n+    for (uint16_t j = 0; j < chain_length; ++j) {\n+        packet[i] = NET_PACKET_FORWARD_REQUEST;\n+        ++i;\n+        memcpy(packet + i, chain_keys + j * CRYPTO_PUBLIC_KEY_SIZE, CRYPTO_PUBLIC_KEY_SIZE);\n+        i += CRYPTO_PUBLIC_KEY_SIZE;\n+    }\n+\n+    memcpy(packet + i, data, data_length);\n+    return true;\n+}\n+\n+non_null()\n+static uint16_t forwarding_packet_length(uint16_t sendback_data_len, uint16_t data_length)\n+{\n+    const uint16_t sendback_len = sendback_data_len == 0 ? 0 : TIMED_AUTH_SIZE + sendback_data_len;\n+    return 1 + 1 + sendback_len + data_length;\n+}\n+\n+non_null(1, 4, 6) nullable(2)\n+static bool create_forwarding_packet(const Forwarding *forwarding,\n+                                     const uint8_t *sendback_data, uint16_t sendback_data_len,\n+                                     const uint8_t *data, uint16_t length,\n+                                     uint8_t *packet)\n+{\n+    *packet = NET_PACKET_FORWARDING;\n+\n+    if (sendback_data_len == 0) {\n+        packet[1] = 0;\n+        memcpy(packet + 1 + 1, data, length);\n+    } else {\n+        const uint16_t sendback_len = TIMED_AUTH_SIZE + sendback_data_len;\n+\n+        if (sendback_len > MAX_SENDBACK_SIZE) {\n+            return false;\n+        }\n+\n+        packet[1] = sendback_len;\n+        generate_timed_auth(forwarding->mono_time, SENDBACK_TIMEOUT, forwarding->hmac_key, sendback_data,\n+                            sendback_data_len, packet + 1 + 1);\n+        memcpy(packet + 1 + 1 + TIMED_AUTH_SIZE, sendback_data, sendback_data_len);\n+        memcpy(packet + 1 + 1 + sendback_len, data, length);\n+    }\n+\n+    return true;\n+}\n+\n+bool send_forwarding(const Forwarding *forwarding, const IP_Port *dest,\n+                     const uint8_t *sendback_data, uint16_t sendback_data_len,\n+                     const uint8_t *data, uint16_t length)\n+{\n+    const uint16_t len = forwarding_packet_length(sendback_data_len, length);\n+    VLA(uint8_t, packet, len);\n+    create_forwarding_packet(forwarding, sendback_data, sendback_data_len, data, length, packet);\n+    return sendpacket(forwarding->net, dest, packet, len) == len;\n+}\n+\n+#define FORWARD_REQUEST_MIN_PACKET_SIZE (1 + CRYPTO_PUBLIC_KEY_SIZE)\n+\n+non_null(1) nullable(2, 4)\n+static bool handle_forward_request_dht(const Forwarding *forwarding,\n+                                       const uint8_t *sendback_data, uint16_t sendback_data_len,\n+                                       const uint8_t *packet, uint16_t length)\n+{\n+    if (length < FORWARD_REQUEST_MIN_PACKET_SIZE) {\n+        return false;\n+    }\n+\n+    const uint8_t *const public_key = packet + 1;\n+    const uint8_t *const forward_data = packet + (1 + CRYPTO_PUBLIC_KEY_SIZE);\n+    const uint16_t forward_data_len = length - (1 + CRYPTO_PUBLIC_KEY_SIZE);\n+\n+    if (TIMED_AUTH_SIZE + sendback_data_len > MAX_SENDBACK_SIZE ||\n+            forward_data_len > MAX_FORWARD_DATA_SIZE) {\n+        return false;\n+    }\n+\n+    const uint16_t len = forwarding_packet_length(sendback_data_len, forward_data_len);\n+    VLA(uint8_t, forwarding_packet, len);\n+\n+    create_forwarding_packet(forwarding, sendback_data, sendback_data_len, forward_data, forward_data_len,\n+                             forwarding_packet);\n+\n+    return route_packet(forwarding->dht, public_key, forwarding_packet, len) == len;\n+}\n+\n+non_null(1, 2) nullable(3, 5)\n+static int handle_forward_request(void *object, const IP_Port *source, const uint8_t *packet, uint16_t length,\n+                                  void *userdata)\n+{\n+    const Forwarding *forwarding = (const Forwarding *)object;\n+\n+    uint8_t sendback_data[1 + MAX_PACKED_IPPORT_SIZE];\n+    sendback_data[0] = SENDBACK_IPPORT;\n+\n+    const int ipport_length = pack_ip_port(forwarding->log, sendback_data + 1, MAX_PACKED_IPPORT_SIZE, source);\n+\n+    if (ipport_length == -1) {\n+        return 1;\n+    }\n+\n+    return handle_forward_request_dht(forwarding, sendback_data, 1 + ipport_length, packet, length) ? 0 : 1;\n+}\n+\n+#define MIN_NONEMPTY_SENDBACK_SIZE TIMED_AUTH_SIZE\n+#define FORWARD_REPLY_MIN_PACKET_SIZE (1 + 1 + MIN_NONEMPTY_SENDBACK_SIZE)\n+\n+non_null(1, 2) nullable(3, 5)\n+static int handle_forward_reply(void *object, const IP_Port *source, const uint8_t *packet, uint16_t length,\n+                                void *userdata)\n+{\n+    const Forwarding *forwarding = (const Forwarding *)object;\n+\n+    if (length < FORWARD_REPLY_MIN_PACKET_SIZE) {\n+        return 1;\n+    }\n+\n+    const uint8_t sendback_len = packet[1];\n+    const uint8_t *const sendback_auth = packet + 1 + 1;\n+    const uint8_t *const sendback_data = sendback_auth + TIMED_AUTH_SIZE;\n+\n+    if (sendback_len > MAX_SENDBACK_SIZE) {\n+        /* value 0xff is reserved for possible future expansion */\n+        return 1;\n+    }\n+\n+    if (sendback_len < TIMED_AUTH_SIZE + 1) {\n+        return 1;\n+    }\n+\n+    const uint16_t sendback_data_len = sendback_len - TIMED_AUTH_SIZE;\n+\n+    if (length < 1 + 1 + sendback_len) {\n+        return 1;\n+    }\n+\n+    const uint8_t *const to_forward = packet + (1 + 1 + sendback_len);\n+    const uint16_t to_forward_len = length - (1 + 1 + sendback_len);\n+\n+    if (!check_timed_auth(forwarding->mono_time, SENDBACK_TIMEOUT, forwarding->hmac_key, sendback_data, sendback_data_len,\n+                          sendback_auth)) {\n+        return 1;\n+    }\n+\n+    if (*sendback_data == SENDBACK_IPPORT) {",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835817597",
            "id": 835817597,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x0ZB9",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 209,
            "original_position": 209,
            "original_start_line": null,
            "path": "toxcore/forwarding.c",
            "position": null,
            "pull_request_review_id": 922301548,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835817597/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-26T22:06:49Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835817597",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835817834"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835817834"
                }
            },
            "author_association": "MEMBER",
            "body": "This function seems to exist so you don't need to pass the DHT to the announce constructor. What was the reasoning here? It's certainly not less code, so are you trying to express some relationships or invariants through this extra code?",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-26T22:06:39Z",
            "diff_hunk": "@@ -0,0 +1,108 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#ifndef C_TOXCORE_TOXCORE_FORWARDING_H\n+#define C_TOXCORE_TOXCORE_FORWARDING_H\n+\n+#include \"DHT.h\"\n+#include \"network.h\"\n+\n+#define SENDBACK_IPPORT 0\n+#define SENDBACK_FORWARD 1\n+#define SENDBACK_TCP 2\n+\n+#define MAX_SENDBACK_SIZE (0xff - 1)\n+#define MAX_FORWARD_DATA_SIZE (MAX_UDP_PACKET_SIZE - (1 + 1 + MAX_SENDBACK_SIZE))\n+\n+#define MAX_FORWARD_CHAIN_LENGTH 4\n+\n+#define MAX_PACKED_IPPORT_SIZE (1 + SIZE_IP6 + sizeof(uint16_t))\n+\n+typedef struct Forwarding Forwarding;\n+\n+non_null()\n+DHT *forwarding_get_dht(Forwarding *forwarding);",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835817834",
            "id": 835817834,
            "line": 29,
            "node_id": "PRRC_kwDOA7zIGs4x0ZFq",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 29,
            "original_position": 25,
            "original_start_line": null,
            "path": "toxcore/forwarding.h",
            "position": 29,
            "pull_request_review_id": 922301548,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835817834/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-26T22:06:49Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835817834",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835977983"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835977983"
                }
            },
            "author_association": "MEMBER",
            "body": "nit: use the new SPDX format of copyright comments.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-27T23:23:11Z",
            "diff_hunk": "@@ -0,0 +1,318 @@\n+/*\n+ * Copyright © 2019 The TokTok team.",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835977983",
            "id": 835977983,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x1AL_",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 2,
            "original_position": 2,
            "original_start_line": null,
            "path": "auto_tests/forwarding_test.c",
            "position": null,
            "pull_request_review_id": 922511514,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835977983/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-27T23:23:47Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835977983",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835978001"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835978001"
                }
            },
            "author_association": "MEMBER",
            "body": "We don't have config.h anymore.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-27T23:23:19Z",
            "diff_hunk": "@@ -0,0 +1,318 @@\n+/*\n+ * Copyright © 2019 The TokTok team.\n+ *\n+ * This file is part of Tox, the free peer to peer instant messenger.\n+ *\n+ * Tox is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Tox is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Tox.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+#ifdef HAVE_CONFIG_H\n+#include \"config.h\"",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r835978001",
            "id": 835978001,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x1AMR",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 21,
            "original_position": 21,
            "original_start_line": null,
            "path": "auto_tests/forwarding_test.c",
            "position": null,
            "pull_request_review_id": 922511514,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835978001/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-27T23:23:47Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/835978001",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855282"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855282"
                }
            },
            "author_association": "MEMBER",
            "body": "done\r\n",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-29T19:51:08Z",
            "diff_hunk": "@@ -0,0 +1,377 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#include \"forwarding.h\"\n+\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"DHT.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+\n+struct Forwarding {\n+    const Logger *log;\n+    DHT *dht;\n+    Mono_Time *mono_time;\n+    Networking_Core *net;\n+\n+    uint8_t hmac_key[CRYPTO_HMAC_KEY_SIZE];\n+\n+    forward_reply_cb *forward_reply_callback;\n+    void *forward_reply_callback_object;\n+\n+    forwarded_request_cb *forwarded_request_callback;\n+    void *forwarded_request_callback_object;\n+\n+    forwarded_response_cb *forwarded_response_callback;\n+    void *forwarded_response_callback_object;\n+};\n+\n+DHT *forwarding_get_dht(Forwarding *forwarding)\n+{\n+    return forwarding->dht;\n+}\n+\n+#define SENDBACK_TIMEOUT 3600\n+\n+bool send_forward_request(Networking_Core *net, const IP_Port *forwarder,\n+                          const uint8_t *chain_keys, uint16_t chain_length,\n+                          const uint8_t *data, uint16_t data_length)\n+{\n+    const uint16_t len = forward_chain_packet_size(chain_length, data_length);\n+    VLA(uint8_t, packet, len);\n+\n+    return create_forward_chain_packet(chain_keys, chain_length, data, data_length, packet)\n+           && sendpacket(net, forwarder, packet, len) == len;\n+}\n+\n+uint16_t forward_chain_packet_size(uint16_t chain_length, uint16_t data_length)\n+{\n+    return chain_length * (1 + CRYPTO_PUBLIC_KEY_SIZE) + data_length;\n+}\n+\n+bool create_forward_chain_packet(const uint8_t *chain_keys, uint16_t chain_length,\n+                                 const uint8_t *data, uint16_t data_length,\n+                                 uint8_t *packet)\n+{\n+    if (chain_length == 0 || chain_length > MAX_FORWARD_CHAIN_LENGTH\n+            || data_length > MAX_FORWARD_DATA_SIZE) {\n+        return false;\n+    }\n+\n+    uint16_t i = 0;\n+\n+    for (uint16_t j = 0; j < chain_length; ++j) {\n+        packet[i] = NET_PACKET_FORWARD_REQUEST;\n+        ++i;\n+        memcpy(packet + i, chain_keys + j * CRYPTO_PUBLIC_KEY_SIZE, CRYPTO_PUBLIC_KEY_SIZE);\n+        i += CRYPTO_PUBLIC_KEY_SIZE;\n+    }\n+\n+    memcpy(packet + i, data, data_length);\n+    return true;\n+}\n+\n+non_null()\n+static uint16_t forwarding_packet_length(uint16_t sendback_data_len, uint16_t data_length)\n+{\n+    const uint16_t sendback_len = sendback_data_len == 0 ? 0 : TIMED_AUTH_SIZE + sendback_data_len;\n+    return 1 + 1 + sendback_len + data_length;\n+}\n+\n+non_null(1, 4, 6) nullable(2)\n+static bool create_forwarding_packet(const Forwarding *forwarding,\n+                                     const uint8_t *sendback_data, uint16_t sendback_data_len,\n+                                     const uint8_t *data, uint16_t length,\n+                                     uint8_t *packet)\n+{\n+    *packet = NET_PACKET_FORWARDING;",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855282",
            "id": 837855282,
            "in_reply_to_id": 835745353,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x8Kgy",
            "original_commit_id": "372df7fe70c7577641febf59d697716a5820b0ef",
            "original_line": 90,
            "original_position": 90,
            "original_start_line": null,
            "path": "toxcore/forwarding.c",
            "position": null,
            "pull_request_review_id": 925159314,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855282/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-29T19:51:09Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855282",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855315"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855315"
                }
            },
            "author_association": "MEMBER",
            "body": "done\r\n",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-29T19:51:11Z",
            "diff_hunk": "@@ -0,0 +1,318 @@\n+/*\n+ * Copyright © 2019 The TokTok team.\n+ *\n+ * This file is part of Tox, the free peer to peer instant messenger.\n+ *\n+ * Tox is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Tox is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Tox.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+#ifdef HAVE_CONFIG_H\n+#include \"config.h\"\n+#endif\n+\n+#include <assert.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"../toxcore/tox.h\"\n+#include \"../toxcore/announce.h\"\n+#include \"../testing/misc_tools.h\"\n+#include \"../toxcore/mono_time.h\"\n+#include \"../toxcore/forwarding.h\"\n+#include \"../toxcore/net_crypto.h\"\n+#include \"../toxcore/util.h\"\n+#include \"auto_test_support.h\"\n+#include \"check_compat.h\"\n+\n+#ifndef USE_IPV6\n+#define USE_IPV6 1\n+#endif\n+\n+static inline IP get_loopback(void)\n+{\n+    IP ip;\n+#if USE_IPV6\n+    ip.family = net_family_ipv6;\n+    ip.ip.v6 = get_ip6_loopback();\n+#else\n+    ip.family = net_family_ipv4;\n+    ip.ip.v4 = get_ip4_loopback();\n+#endif\n+    return ip;\n+}\n+\n+#define NUM_FORWARDER 20\n+#define NUM_FORWARDER_TCP 5\n+#define NUM_FORWARDER_DHT (NUM_FORWARDER - NUM_FORWARDER_TCP)\n+#define NUM_FORWARDING_ITERATIONS 1\n+#define FORWARD_SEND_INTERVAL 2\n+#define FORWARDER_TCP_RELAY_PORT 36570\n+#define FORWARDING_BASE_PORT 36571\n+\n+typedef struct Test_Data {\n+    Networking_Core *net;\n+    uint32_t send_back;\n+    uint64_t sent;\n+    bool returned;\n+} Test_Data;\n+\n+static void test_forwarded_request_cb(void *object, const IP_Port *forwarder,\n+                                      const uint8_t *sendback, uint16_t sendback_length,\n+                                      const uint8_t *data, uint16_t length, void *userdata)\n+{\n+    Test_Data *test_data = (Test_Data *)object;\n+    uint8_t *index = (uint8_t *)userdata;\n+\n+    if (length != 12 || memcmp(\"hello:  \", data, 8) != 0) {\n+        printf(\"[%u] got unexpected data of length %d\\n\", *index, length);\n+        return;\n+    }\n+\n+    uint8_t reply[12];\n+    memcpy(reply, \"reply:  \", 8);\n+    memcpy(reply + 8, data + 8, 4);\n+    ck_assert_msg(forward_reply(test_data->net, forwarder, sendback, sendback_length, reply, 12),\n+                  \"[%u] forward_reply failed\", *index);\n+}\n+\n+static void test_forwarded_response_cb(void *object,\n+                                       const uint8_t *data, uint16_t length, void *userdata)\n+{\n+    Test_Data *test_data = (Test_Data *)object;\n+    uint8_t *index = (uint8_t *)userdata;\n+\n+    if (length != 12 || memcmp(\"reply:  \", data, 8) != 0) {\n+        printf(\"[%u] got unexpected data of length %d\\n\", *index, length);\n+        return;\n+    }\n+\n+    uint32_t send_back;\n+    net_unpack_u32(data + 8, &send_back);\n+\n+    if (test_data->send_back == send_back) {\n+        test_data->returned = true;\n+    }\n+}\n+\n+static bool all_returned(Test_Data *test_data)\n+{\n+    for (uint32_t i = 0; i < NUM_FORWARDER; ++i) {\n+        if (!test_data[i].returned) {\n+            return false;\n+        }\n+    }\n+\n+    return true;\n+}\n+\n+static void test_forwarding(void)\n+{\n+    assert(sizeof(char) == 1);\n+\n+    uint32_t index[NUM_FORWARDER];",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855315",
            "id": 837855315,
            "in_reply_to_id": 835816139,
            "line": 161,
            "node_id": "PRRC_kwDOA7zIGs4x8KhT",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 161,
            "original_position": 123,
            "original_start_line": null,
            "path": "auto_tests/forwarding_test.c",
            "position": 161,
            "pull_request_review_id": 925159362,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855315/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-29T19:51:12Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855315",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855509"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855509"
                }
            },
            "author_association": "MEMBER",
            "body": "done\r\n",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-29T19:51:26Z",
            "diff_hunk": "@@ -564,22 +565,47 @@ static int rm_connection_index(TCP_Server *tcp_server, TCP_Secure_Connection *co\n     return -1;\n }\n \n+/* Encode con_id and identifier as a custom IP_Port.",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855509",
            "id": 837855509,
            "in_reply_to_id": 835816320,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x8KkV",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 568,
            "original_position": 12,
            "original_start_line": null,
            "path": "toxcore/TCP_server.c",
            "position": null,
            "pull_request_review_id": 925159618,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855509/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-29T19:51:26Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855509",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855532"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855532"
                }
            },
            "author_association": "MEMBER",
            "body": "done",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-29T19:51:28Z",
            "diff_hunk": "@@ -564,22 +565,47 @@ static int rm_connection_index(TCP_Server *tcp_server, TCP_Secure_Connection *co\n     return -1;\n }\n \n+/* Encode con_id and identifier as a custom IP_Port.\n+ *\n+ * return ip_port.\n+ */\n+static IP_Port con_id_to_ip_port(uint32_t con_id, uint64_t identifier)\n+{\n+    IP_Port ip_port = {{{0}}};\n+    ip_port.ip.family = net_family_tcp_client;\n+    ip_port.ip.ip.v6.uint32[0] = con_id;\n+    ip_port.ip.ip.v6.uint64[1] = identifier;\n+    return ip_port;\n+\n+}\n+\n+/* Decode ip_port created by con_id_to_ip_port to con_id.",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855532",
            "id": 837855532,
            "in_reply_to_id": 835816331,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x8Kks",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 582,
            "original_position": 26,
            "original_start_line": null,
            "path": "toxcore/TCP_server.c",
            "position": null,
            "pull_request_review_id": 925159669,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855532/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-29T19:51:29Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855532",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855637"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855637"
                }
            },
            "author_association": "MEMBER",
            "body": "done (astyle didn't)",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-29T19:51:38Z",
            "diff_hunk": "@@ -0,0 +1,644 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2020-2021 The TokTok team.\n+ */\n+\n+/**\n+ * \"Server side\" of the DHT announcements protocol.\n+ * */\n+\n+#include \"announce.h\"\n+\n+#include <assert.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"LAN_discovery.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+#include \"util.h\"\n+\n+uint8_t response_of_request_type(uint8_t request_type)\n+{\n+    switch (request_type) {\n+        case NET_PACKET_DATA_SEARCH_REQUEST :",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855637",
            "id": 837855637,
            "in_reply_to_id": 835816746,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x8KmV",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 23,
            "original_position": 23,
            "original_start_line": null,
            "path": "toxcore/announce.c",
            "position": null,
            "pull_request_review_id": 925159826,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855637/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-29T19:51:38Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855637",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855704"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855704"
                }
            },
            "author_association": "MEMBER",
            "body": "done",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-29T19:51:43Z",
            "diff_hunk": "@@ -0,0 +1,644 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2020-2021 The TokTok team.\n+ */\n+\n+/**\n+ * \"Server side\" of the DHT announcements protocol.\n+ * */\n+\n+#include \"announce.h\"\n+\n+#include <assert.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"LAN_discovery.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+#include \"util.h\"\n+\n+uint8_t response_of_request_type(uint8_t request_type)\n+{\n+    switch (request_type) {\n+        case NET_PACKET_DATA_SEARCH_REQUEST :\n+            return NET_PACKET_DATA_SEARCH_RESPONSE;\n+\n+        case NET_PACKET_DATA_RETRIEVE_REQUEST :\n+            return NET_PACKET_DATA_RETRIEVE_RESPONSE;\n+\n+        case NET_PACKET_STORE_ANNOUNCE_REQUEST :\n+            return NET_PACKET_STORE_ANNOUNCE_RESPONSE;\n+\n+        default : {\n+            assert(false);\n+            return NET_PACKET_MAX;\n+        }\n+    }\n+}\n+\n+typedef struct Announce_Entry {\n+    uint64_t store_until;\n+    uint8_t data_public_key[CRYPTO_PUBLIC_KEY_SIZE];\n+    uint8_t *data;\n+    uint32_t length;\n+} Announce_Entry;\n+\n+struct Announcements {\n+    const Logger *log;\n+    Forwarding *forwarding;\n+    Mono_Time *mono_time;\n+    DHT *dht;\n+    Networking_Core *net;\n+    const uint8_t *public_key;\n+    const uint8_t *secret_key;\n+\n+    Shared_Keys shared_keys;\n+    uint8_t hmac_key[CRYPTO_HMAC_KEY_SIZE];\n+\n+    int32_t synch_offset;\n+\n+    uint64_t start_time;\n+\n+    Announce_Entry entries[ANNOUNCE_BUCKETS * ANNOUNCE_BUCKET_SIZE];\n+};\n+\n+void set_synch_offset(Announcements *announce, int32_t synch_offset)\n+{\n+    announce->synch_offset = synch_offset;\n+}\n+\n+/* An entry is considered to be \"deleted\" for the purposes of the protocol\n+ * once it has timed out. */\n+non_null()\n+static bool entry_is_empty(const Announcements *announce, const Announce_Entry *entry)\n+{\n+    return mono_time_get(announce->mono_time) >= entry->store_until;\n+}\n+\n+non_null()\n+static void delete_entry(Announce_Entry *entry)\n+{\n+    entry->store_until = 0;\n+}\n+\n+/* Return bits (at most 8) from pk starting at index as uint8_t */\n+non_null()\n+static uint8_t truncate_pk_at_index(const uint8_t *pk, uint16_t index, uint16_t bits)\n+{\n+    assert(bits < 8);\n+    const uint8_t i = index / 8;\n+    const uint8_t j = index % 8;\n+    return ((uint8_t)((i < CRYPTO_PUBLIC_KEY_SIZE ? pk[i] : 0) << j) >> (8 - bits)) |\n+           ((i + 1 < CRYPTO_PUBLIC_KEY_SIZE ? pk[i + 1] : 0) >> (16 - bits - j));\n+}\n+\n+uint16_t get_bucketnum(const uint8_t *base, const uint8_t *pk)\n+{\n+    const uint16_t index = bit_by_bit_cmp(base, pk);\n+\n+    return truncate_pk_at_index(base, index + 1, ANNOUNCE_BUCKET_PREFIX_LENGTH) ^\n+           truncate_pk_at_index(pk, index + 1, ANNOUNCE_BUCKET_PREFIX_LENGTH);\n+}\n+\n+non_null()\n+static Announce_Entry *bucket_of_key(Announcements *announce, const uint8_t *pk)\n+{\n+    return &announce->entries[get_bucketnum(announce->public_key, pk) * ANNOUNCE_BUCKET_SIZE];\n+}\n+\n+non_null()\n+static Announce_Entry *get_stored(Announcements *announce, const uint8_t *data_public_key)\n+{\n+    Announce_Entry *const bucket = bucket_of_key(announce, data_public_key);\n+\n+    for (uint32_t i = 0; i < ANNOUNCE_BUCKET_SIZE; ++i) {\n+        if (pk_equal(bucket[i].data_public_key, data_public_key)) {\n+            if (entry_is_empty(announce, &bucket[i])) {\n+                break;\n+            }\n+\n+            return &bucket[i];\n+        }\n+    }\n+\n+    return nullptr;\n+}\n+\n+non_null()\n+static const Announce_Entry *bucket_of_key_const(const Announcements *announce, const uint8_t *pk)\n+{\n+    return &announce->entries[get_bucketnum(announce->public_key, pk) * ANNOUNCE_BUCKET_SIZE];\n+}\n+\n+non_null()\n+static const Announce_Entry *get_stored_const(const Announcements *announce, const uint8_t *data_public_key)\n+{\n+    const Announce_Entry *const bucket = bucket_of_key_const(announce, data_public_key);\n+\n+    for (uint32_t i = 0; i < ANNOUNCE_BUCKET_SIZE; ++i) {\n+        if (pk_equal(bucket[i].data_public_key, data_public_key)) {\n+            if (entry_is_empty(announce, &bucket[i])) {\n+                break;\n+            }\n+\n+            return &bucket[i];\n+        }\n+    }\n+\n+    return nullptr;\n+}\n+\n+\n+bool on_stored(const Announcements *announce, const uint8_t *data_public_key,\n+               on_retrieve_cb *on_retrieve_callback, void *object)\n+{\n+    const Announce_Entry *const entry = get_stored_const(announce, data_public_key);\n+\n+    if (entry == nullptr || entry->data == nullptr) {\n+        return false;\n+    }\n+\n+    if (on_retrieve_callback != nullptr) {\n+        on_retrieve_callback(object, entry->data, entry->length);\n+    }\n+\n+    return true;\n+}\n+\n+/* Returns existing entry for this key if it exists, else an empty",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855704",
            "id": 837855704,
            "in_reply_to_id": 835816776,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x8KnY",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 168,
            "original_position": 168,
            "original_start_line": null,
            "path": "toxcore/announce.c",
            "position": null,
            "pull_request_review_id": 925159931,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855704/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-29T19:51:43Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855704",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855824"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855824"
                }
            },
            "author_association": "MEMBER",
            "body": "made it `offset`",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-29T19:51:54Z",
            "diff_hunk": "@@ -0,0 +1,377 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#include \"forwarding.h\"\n+\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"DHT.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+\n+struct Forwarding {\n+    const Logger *log;\n+    DHT *dht;\n+    Mono_Time *mono_time;\n+    Networking_Core *net;\n+\n+    uint8_t hmac_key[CRYPTO_HMAC_KEY_SIZE];\n+\n+    forward_reply_cb *forward_reply_callback;\n+    void *forward_reply_callback_object;\n+\n+    forwarded_request_cb *forwarded_request_callback;\n+    void *forwarded_request_callback_object;\n+\n+    forwarded_response_cb *forwarded_response_callback;\n+    void *forwarded_response_callback_object;\n+};\n+\n+DHT *forwarding_get_dht(Forwarding *forwarding)\n+{\n+    return forwarding->dht;\n+}\n+\n+#define SENDBACK_TIMEOUT 3600\n+\n+bool send_forward_request(Networking_Core *net, const IP_Port *forwarder,\n+                          const uint8_t *chain_keys, uint16_t chain_length,\n+                          const uint8_t *data, uint16_t data_length)\n+{\n+    const uint16_t len = forward_chain_packet_size(chain_length, data_length);\n+    VLA(uint8_t, packet, len);\n+\n+    return create_forward_chain_packet(chain_keys, chain_length, data, data_length, packet)\n+           && sendpacket(net, forwarder, packet, len) == len;\n+}\n+\n+uint16_t forward_chain_packet_size(uint16_t chain_length, uint16_t data_length)\n+{\n+    return chain_length * (1 + CRYPTO_PUBLIC_KEY_SIZE) + data_length;\n+}\n+\n+bool create_forward_chain_packet(const uint8_t *chain_keys, uint16_t chain_length,\n+                                 const uint8_t *data, uint16_t data_length,\n+                                 uint8_t *packet)\n+{\n+    if (chain_length == 0 || chain_length > MAX_FORWARD_CHAIN_LENGTH\n+            || data_length > MAX_FORWARD_DATA_SIZE) {\n+        return false;\n+    }\n+\n+    uint16_t i = 0;",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855824",
            "id": 837855824,
            "in_reply_to_id": 835817299,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x8KpQ",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 64,
            "original_position": 64,
            "original_start_line": null,
            "path": "toxcore/forwarding.c",
            "position": null,
            "pull_request_review_id": 925160096,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855824/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-29T19:51:54Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855824",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855893"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855893"
                }
            },
            "author_association": "MEMBER",
            "body": "done",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-29T19:51:59Z",
            "diff_hunk": "@@ -0,0 +1,377 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#include \"forwarding.h\"\n+\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"DHT.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+\n+struct Forwarding {\n+    const Logger *log;\n+    DHT *dht;\n+    Mono_Time *mono_time;\n+    Networking_Core *net;\n+\n+    uint8_t hmac_key[CRYPTO_HMAC_KEY_SIZE];\n+\n+    forward_reply_cb *forward_reply_callback;\n+    void *forward_reply_callback_object;\n+\n+    forwarded_request_cb *forwarded_request_callback;\n+    void *forwarded_request_callback_object;\n+\n+    forwarded_response_cb *forwarded_response_callback;\n+    void *forwarded_response_callback_object;\n+};\n+\n+DHT *forwarding_get_dht(Forwarding *forwarding)\n+{\n+    return forwarding->dht;\n+}\n+\n+#define SENDBACK_TIMEOUT 3600\n+\n+bool send_forward_request(Networking_Core *net, const IP_Port *forwarder,\n+                          const uint8_t *chain_keys, uint16_t chain_length,\n+                          const uint8_t *data, uint16_t data_length)\n+{\n+    const uint16_t len = forward_chain_packet_size(chain_length, data_length);\n+    VLA(uint8_t, packet, len);\n+\n+    return create_forward_chain_packet(chain_keys, chain_length, data, data_length, packet)\n+           && sendpacket(net, forwarder, packet, len) == len;\n+}\n+\n+uint16_t forward_chain_packet_size(uint16_t chain_length, uint16_t data_length)\n+{\n+    return chain_length * (1 + CRYPTO_PUBLIC_KEY_SIZE) + data_length;\n+}\n+\n+bool create_forward_chain_packet(const uint8_t *chain_keys, uint16_t chain_length,\n+                                 const uint8_t *data, uint16_t data_length,\n+                                 uint8_t *packet)\n+{\n+    if (chain_length == 0 || chain_length > MAX_FORWARD_CHAIN_LENGTH\n+            || data_length > MAX_FORWARD_DATA_SIZE) {\n+        return false;\n+    }\n+\n+    uint16_t i = 0;\n+\n+    for (uint16_t j = 0; j < chain_length; ++j) {\n+        packet[i] = NET_PACKET_FORWARD_REQUEST;\n+        ++i;\n+        memcpy(packet + i, chain_keys + j * CRYPTO_PUBLIC_KEY_SIZE, CRYPTO_PUBLIC_KEY_SIZE);\n+        i += CRYPTO_PUBLIC_KEY_SIZE;\n+    }\n+\n+    memcpy(packet + i, data, data_length);\n+    return true;\n+}\n+\n+non_null()\n+static uint16_t forwarding_packet_length(uint16_t sendback_data_len, uint16_t data_length)\n+{\n+    const uint16_t sendback_len = sendback_data_len == 0 ? 0 : TIMED_AUTH_SIZE + sendback_data_len;\n+    return 1 + 1 + sendback_len + data_length;\n+}\n+\n+non_null(1, 4, 6) nullable(2)\n+static bool create_forwarding_packet(const Forwarding *forwarding,\n+                                     const uint8_t *sendback_data, uint16_t sendback_data_len,\n+                                     const uint8_t *data, uint16_t length,\n+                                     uint8_t *packet)\n+{\n+    *packet = NET_PACKET_FORWARDING;\n+\n+    if (sendback_data_len == 0) {\n+        packet[1] = 0;\n+        memcpy(packet + 1 + 1, data, length);\n+    } else {\n+        const uint16_t sendback_len = TIMED_AUTH_SIZE + sendback_data_len;\n+\n+        if (sendback_len > MAX_SENDBACK_SIZE) {\n+            return false;\n+        }\n+\n+        packet[1] = sendback_len;\n+        generate_timed_auth(forwarding->mono_time, SENDBACK_TIMEOUT, forwarding->hmac_key, sendback_data,\n+                            sendback_data_len, packet + 1 + 1);\n+        memcpy(packet + 1 + 1 + TIMED_AUTH_SIZE, sendback_data, sendback_data_len);\n+        memcpy(packet + 1 + 1 + sendback_len, data, length);\n+    }\n+\n+    return true;\n+}\n+\n+bool send_forwarding(const Forwarding *forwarding, const IP_Port *dest,\n+                     const uint8_t *sendback_data, uint16_t sendback_data_len,\n+                     const uint8_t *data, uint16_t length)\n+{\n+    const uint16_t len = forwarding_packet_length(sendback_data_len, length);\n+    VLA(uint8_t, packet, len);\n+    create_forwarding_packet(forwarding, sendback_data, sendback_data_len, data, length, packet);\n+    return sendpacket(forwarding->net, dest, packet, len) == len;\n+}\n+\n+#define FORWARD_REQUEST_MIN_PACKET_SIZE (1 + CRYPTO_PUBLIC_KEY_SIZE)\n+\n+non_null(1) nullable(2, 4)\n+static bool handle_forward_request_dht(const Forwarding *forwarding,\n+                                       const uint8_t *sendback_data, uint16_t sendback_data_len,\n+                                       const uint8_t *packet, uint16_t length)\n+{\n+    if (length < FORWARD_REQUEST_MIN_PACKET_SIZE) {\n+        return false;\n+    }\n+\n+    const uint8_t *const public_key = packet + 1;\n+    const uint8_t *const forward_data = packet + (1 + CRYPTO_PUBLIC_KEY_SIZE);\n+    const uint16_t forward_data_len = length - (1 + CRYPTO_PUBLIC_KEY_SIZE);\n+\n+    if (TIMED_AUTH_SIZE + sendback_data_len > MAX_SENDBACK_SIZE ||\n+            forward_data_len > MAX_FORWARD_DATA_SIZE) {\n+        return false;\n+    }\n+\n+    const uint16_t len = forwarding_packet_length(sendback_data_len, forward_data_len);\n+    VLA(uint8_t, forwarding_packet, len);\n+\n+    create_forwarding_packet(forwarding, sendback_data, sendback_data_len, forward_data, forward_data_len,\n+                             forwarding_packet);\n+\n+    return route_packet(forwarding->dht, public_key, forwarding_packet, len) == len;\n+}\n+\n+non_null(1, 2) nullable(3, 5)\n+static int handle_forward_request(void *object, const IP_Port *source, const uint8_t *packet, uint16_t length,\n+                                  void *userdata)\n+{\n+    const Forwarding *forwarding = (const Forwarding *)object;\n+\n+    uint8_t sendback_data[1 + MAX_PACKED_IPPORT_SIZE];\n+    sendback_data[0] = SENDBACK_IPPORT;\n+\n+    const int ipport_length = pack_ip_port(forwarding->log, sendback_data + 1, MAX_PACKED_IPPORT_SIZE, source);\n+\n+    if (ipport_length == -1) {\n+        return 1;\n+    }\n+\n+    return handle_forward_request_dht(forwarding, sendback_data, 1 + ipport_length, packet, length) ? 0 : 1;\n+}\n+\n+#define MIN_NONEMPTY_SENDBACK_SIZE TIMED_AUTH_SIZE\n+#define FORWARD_REPLY_MIN_PACKET_SIZE (1 + 1 + MIN_NONEMPTY_SENDBACK_SIZE)\n+\n+non_null(1, 2) nullable(3, 5)\n+static int handle_forward_reply(void *object, const IP_Port *source, const uint8_t *packet, uint16_t length,\n+                                void *userdata)\n+{\n+    const Forwarding *forwarding = (const Forwarding *)object;\n+\n+    if (length < FORWARD_REPLY_MIN_PACKET_SIZE) {\n+        return 1;\n+    }\n+\n+    const uint8_t sendback_len = packet[1];\n+    const uint8_t *const sendback_auth = packet + 1 + 1;\n+    const uint8_t *const sendback_data = sendback_auth + TIMED_AUTH_SIZE;\n+\n+    if (sendback_len > MAX_SENDBACK_SIZE) {\n+        /* value 0xff is reserved for possible future expansion */\n+        return 1;\n+    }\n+\n+    if (sendback_len < TIMED_AUTH_SIZE + 1) {\n+        return 1;\n+    }\n+\n+    const uint16_t sendback_data_len = sendback_len - TIMED_AUTH_SIZE;\n+\n+    if (length < 1 + 1 + sendback_len) {\n+        return 1;\n+    }\n+\n+    const uint8_t *const to_forward = packet + (1 + 1 + sendback_len);\n+    const uint16_t to_forward_len = length - (1 + 1 + sendback_len);\n+\n+    if (!check_timed_auth(forwarding->mono_time, SENDBACK_TIMEOUT, forwarding->hmac_key, sendback_data, sendback_data_len,\n+                          sendback_auth)) {\n+        return 1;\n+    }\n+\n+    if (*sendback_data == SENDBACK_IPPORT) {",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837855893",
            "id": 837855893,
            "in_reply_to_id": 835817597,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x8KqV",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 209,
            "original_position": 209,
            "original_start_line": null,
            "path": "toxcore/forwarding.c",
            "position": null,
            "pull_request_review_id": 925160204,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855893/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-29T19:52:00Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837855893",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837856800"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837856800"
                }
            },
            "author_association": "MEMBER",
            "body": "It expresses that the dht object directly used for announce and that used by announce's forwarding object should be the same.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-29T19:53:14Z",
            "diff_hunk": "@@ -0,0 +1,108 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#ifndef C_TOXCORE_TOXCORE_FORWARDING_H\n+#define C_TOXCORE_TOXCORE_FORWARDING_H\n+\n+#include \"DHT.h\"\n+#include \"network.h\"\n+\n+#define SENDBACK_IPPORT 0\n+#define SENDBACK_FORWARD 1\n+#define SENDBACK_TCP 2\n+\n+#define MAX_SENDBACK_SIZE (0xff - 1)\n+#define MAX_FORWARD_DATA_SIZE (MAX_UDP_PACKET_SIZE - (1 + 1 + MAX_SENDBACK_SIZE))\n+\n+#define MAX_FORWARD_CHAIN_LENGTH 4\n+\n+#define MAX_PACKED_IPPORT_SIZE (1 + SIZE_IP6 + sizeof(uint16_t))\n+\n+typedef struct Forwarding Forwarding;\n+\n+non_null()\n+DHT *forwarding_get_dht(Forwarding *forwarding);",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837856800",
            "id": 837856800,
            "in_reply_to_id": 835817834,
            "line": 29,
            "node_id": "PRRC_kwDOA7zIGs4x8K4g",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 29,
            "original_position": 25,
            "original_start_line": null,
            "path": "toxcore/forwarding.h",
            "position": 29,
            "pull_request_review_id": 925161451,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837856800/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-29T19:53:14Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837856800",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837856999"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837856999"
                }
            },
            "author_association": "MEMBER",
            "body": "I just deleted the copyright block, because the other auto_tests seem not to have one.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-29T19:53:32Z",
            "diff_hunk": "@@ -0,0 +1,318 @@\n+/*\n+ * Copyright © 2019 The TokTok team.",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837856999",
            "id": 837856999,
            "in_reply_to_id": 835977983,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x8K7n",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 2,
            "original_position": 2,
            "original_start_line": null,
            "path": "auto_tests/forwarding_test.c",
            "position": null,
            "pull_request_review_id": 925161744,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837856999/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-29T19:53:32Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837856999",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837857062"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837857062"
                }
            },
            "author_association": "MEMBER",
            "body": "done",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-29T19:53:37Z",
            "diff_hunk": "@@ -0,0 +1,318 @@\n+/*\n+ * Copyright © 2019 The TokTok team.\n+ *\n+ * This file is part of Tox, the free peer to peer instant messenger.\n+ *\n+ * Tox is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Tox is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Tox.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+#ifdef HAVE_CONFIG_H\n+#include \"config.h\"",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837857062",
            "id": 837857062,
            "in_reply_to_id": 835978001,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4x8K8m",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 21,
            "original_position": 21,
            "original_start_line": null,
            "path": "auto_tests/forwarding_test.c",
            "position": null,
            "pull_request_review_id": 925161851,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837857062/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-29T19:53:37Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837857062",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837888317"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837888317"
                }
            },
            "author_association": "MEMBER",
            "body": "SGTM.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-03-29T20:35:19Z",
            "diff_hunk": "@@ -0,0 +1,108 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#ifndef C_TOXCORE_TOXCORE_FORWARDING_H\n+#define C_TOXCORE_TOXCORE_FORWARDING_H\n+\n+#include \"DHT.h\"\n+#include \"network.h\"\n+\n+#define SENDBACK_IPPORT 0\n+#define SENDBACK_FORWARD 1\n+#define SENDBACK_TCP 2\n+\n+#define MAX_SENDBACK_SIZE (0xff - 1)\n+#define MAX_FORWARD_DATA_SIZE (MAX_UDP_PACKET_SIZE - (1 + 1 + MAX_SENDBACK_SIZE))\n+\n+#define MAX_FORWARD_CHAIN_LENGTH 4\n+\n+#define MAX_PACKED_IPPORT_SIZE (1 + SIZE_IP6 + sizeof(uint16_t))\n+\n+typedef struct Forwarding Forwarding;\n+\n+non_null()\n+DHT *forwarding_get_dht(Forwarding *forwarding);",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r837888317",
            "id": 837888317,
            "in_reply_to_id": 835817834,
            "line": 29,
            "node_id": "PRRC_kwDOA7zIGs4x8Sk9",
            "original_commit_id": "be83238bfacffbe5beda972b5ce5eaeadbbd6710",
            "original_line": 29,
            "original_position": 25,
            "original_start_line": null,
            "path": "toxcore/forwarding.h",
            "position": 29,
            "pull_request_review_id": 925206296,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837888317/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-03-29T20:35:19Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/837888317",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841053498"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841053498"
                }
            },
            "author_association": "MEMBER",
            "body": "`chain_keys` is undocumented. Can you make it doxygen-style comments with `@param` and stuff? That way this becomes more obvious. It's important to document that `chain_keys` is `key size * chain_length` in size.\r\n\r\nAlso, this function needs to check its inputs. E.g. check that chain_length is actually `<= MAX_FORWARD_CHAIN_LENGTH` and data_length etc.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-04-02T09:23:57Z",
            "diff_hunk": "@@ -0,0 +1,108 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#ifndef C_TOXCORE_TOXCORE_FORWARDING_H\n+#define C_TOXCORE_TOXCORE_FORWARDING_H\n+\n+#include \"DHT.h\"\n+#include \"network.h\"\n+\n+#define SENDBACK_IPPORT 0\n+#define SENDBACK_FORWARD 1\n+#define SENDBACK_TCP 2\n+\n+#define MAX_SENDBACK_SIZE (0xff - 1)\n+#define MAX_FORWARD_DATA_SIZE (MAX_UDP_PACKET_SIZE - (1 + 1 + MAX_SENDBACK_SIZE))\n+\n+#define MAX_FORWARD_CHAIN_LENGTH 4\n+\n+#define MAX_PACKED_IPPORT_SIZE (1 + SIZE_IP6 + sizeof(uint16_t))\n+\n+typedef struct Forwarding Forwarding;\n+\n+non_null()\n+DHT *forwarding_get_dht(Forwarding *forwarding);\n+\n+/**\n+ * Send data to forwarder for forwarding via chain of dht nodes.\n+ * Destination is last key in the chain.\n+ * Maximum data_length is MAX_FORWARD_DATA_SIZE.\n+ * Maximum chain_length MAX_FORWARD_CHAIN_LENGTH, minimum 1.",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841053498",
            "id": 841053498,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4yIXU6",
            "original_commit_id": "92e726284f529040fd56af40f3e7cd573a4135dc",
            "original_line": 31,
            "original_position": 31,
            "original_start_line": null,
            "path": "toxcore/forwarding.h",
            "position": null,
            "pull_request_review_id": 929552652,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841053498/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-04-02T09:24:02Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841053498",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841053708"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841053708"
                }
            },
            "author_association": "MEMBER",
            "body": "This VLA can grow indefinitely given malicious inputs. I see `create_forward_chain_packet` does check its inputs, but `send_forward_request` doesn't.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-04-02T09:25:34Z",
            "diff_hunk": "@@ -0,0 +1,385 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#include \"forwarding.h\"\n+\n+#include <assert.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"DHT.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+\n+struct Forwarding {\n+    const Logger *log;\n+    const Random *rng;\n+    DHT *dht;\n+    const Mono_Time *mono_time;\n+    Networking_Core *net;\n+\n+    uint8_t hmac_key[CRYPTO_HMAC_KEY_SIZE];\n+\n+    forward_reply_cb *forward_reply_callback;\n+    void *forward_reply_callback_object;\n+\n+    forwarded_request_cb *forwarded_request_callback;\n+    void *forwarded_request_callback_object;\n+\n+    forwarded_response_cb *forwarded_response_callback;\n+    void *forwarded_response_callback_object;\n+};\n+\n+DHT *forwarding_get_dht(Forwarding *forwarding)\n+{\n+    return forwarding->dht;\n+}\n+\n+#define SENDBACK_TIMEOUT 3600\n+\n+bool send_forward_request(Networking_Core *net, const IP_Port *forwarder,\n+                          const uint8_t *chain_keys, uint16_t chain_length,\n+                          const uint8_t *data, uint16_t data_length)\n+{\n+    const uint16_t len = forward_chain_packet_size(chain_length, data_length);\n+    VLA(uint8_t, packet, len);",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841053708",
            "id": 841053708,
            "line": 51,
            "node_id": "PRRC_kwDOA7zIGs4yIXYM",
            "original_commit_id": "92e726284f529040fd56af40f3e7cd573a4135dc",
            "original_line": 51,
            "original_position": 46,
            "original_start_line": null,
            "path": "toxcore/forwarding.c",
            "position": 51,
            "pull_request_review_id": 929552791,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841053708/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-04-02T09:25:37Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841053708",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841056126"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841056126"
                }
            },
            "author_association": "MEMBER",
            "body": "done",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-04-02T09:50:45Z",
            "diff_hunk": "@@ -0,0 +1,108 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#ifndef C_TOXCORE_TOXCORE_FORWARDING_H\n+#define C_TOXCORE_TOXCORE_FORWARDING_H\n+\n+#include \"DHT.h\"\n+#include \"network.h\"\n+\n+#define SENDBACK_IPPORT 0\n+#define SENDBACK_FORWARD 1\n+#define SENDBACK_TCP 2\n+\n+#define MAX_SENDBACK_SIZE (0xff - 1)\n+#define MAX_FORWARD_DATA_SIZE (MAX_UDP_PACKET_SIZE - (1 + 1 + MAX_SENDBACK_SIZE))\n+\n+#define MAX_FORWARD_CHAIN_LENGTH 4\n+\n+#define MAX_PACKED_IPPORT_SIZE (1 + SIZE_IP6 + sizeof(uint16_t))\n+\n+typedef struct Forwarding Forwarding;\n+\n+non_null()\n+DHT *forwarding_get_dht(Forwarding *forwarding);\n+\n+/**\n+ * Send data to forwarder for forwarding via chain of dht nodes.\n+ * Destination is last key in the chain.\n+ * Maximum data_length is MAX_FORWARD_DATA_SIZE.\n+ * Maximum chain_length MAX_FORWARD_CHAIN_LENGTH, minimum 1.",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841056126",
            "id": 841056126,
            "in_reply_to_id": 841053498,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4yIX9-",
            "original_commit_id": "92e726284f529040fd56af40f3e7cd573a4135dc",
            "original_line": 31,
            "original_position": 31,
            "original_start_line": null,
            "path": "toxcore/forwarding.h",
            "position": null,
            "pull_request_review_id": 929554780,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841056126/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-04-02T09:50:46Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841056126",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841056131"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841056131"
                }
            },
            "author_association": "MEMBER",
            "body": "done",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-04-02T09:50:51Z",
            "diff_hunk": "@@ -0,0 +1,385 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2019-2022 The TokTok team.\n+ */\n+\n+#include \"forwarding.h\"\n+\n+#include <assert.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"DHT.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+\n+struct Forwarding {\n+    const Logger *log;\n+    const Random *rng;\n+    DHT *dht;\n+    const Mono_Time *mono_time;\n+    Networking_Core *net;\n+\n+    uint8_t hmac_key[CRYPTO_HMAC_KEY_SIZE];\n+\n+    forward_reply_cb *forward_reply_callback;\n+    void *forward_reply_callback_object;\n+\n+    forwarded_request_cb *forwarded_request_callback;\n+    void *forwarded_request_callback_object;\n+\n+    forwarded_response_cb *forwarded_response_callback;\n+    void *forwarded_response_callback_object;\n+};\n+\n+DHT *forwarding_get_dht(Forwarding *forwarding)\n+{\n+    return forwarding->dht;\n+}\n+\n+#define SENDBACK_TIMEOUT 3600\n+\n+bool send_forward_request(Networking_Core *net, const IP_Port *forwarder,\n+                          const uint8_t *chain_keys, uint16_t chain_length,\n+                          const uint8_t *data, uint16_t data_length)\n+{\n+    const uint16_t len = forward_chain_packet_size(chain_length, data_length);\n+    VLA(uint8_t, packet, len);",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841056131",
            "id": 841056131,
            "in_reply_to_id": 841053708,
            "line": 51,
            "node_id": "PRRC_kwDOA7zIGs4yIX-D",
            "original_commit_id": "92e726284f529040fd56af40f3e7cd573a4135dc",
            "original_line": 51,
            "original_position": 46,
            "original_start_line": null,
            "path": "toxcore/forwarding.c",
            "position": 51,
            "pull_request_review_id": 929554788,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841056131/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-04-02T09:50:51Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841056131",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841074205"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841074205"
                }
            },
            "author_association": "MEMBER",
            "body": "This looks like a `switch`. Also, it's probably worth extracting functions for each of the cases, as they are quite large.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-04-02T13:02:54Z",
            "diff_hunk": "@@ -0,0 +1,649 @@\n+/* SPDX-License-Identifier: GPL-3.0-or-later\n+ * Copyright © 2020-2021 The TokTok team.\n+ */\n+\n+/**\n+ * \"Server side\" of the DHT announcements protocol.\n+ * */\n+\n+#include \"announce.h\"\n+\n+#include <assert.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"LAN_discovery.h\"\n+#include \"ccompat.h\"\n+#include \"timed_auth.h\"\n+#include \"util.h\"\n+\n+uint8_t response_of_request_type(uint8_t request_type)\n+{\n+    switch (request_type) {\n+        case NET_PACKET_DATA_SEARCH_REQUEST:\n+            return NET_PACKET_DATA_SEARCH_RESPONSE;\n+\n+        case NET_PACKET_DATA_RETRIEVE_REQUEST:\n+            return NET_PACKET_DATA_RETRIEVE_RESPONSE;\n+\n+        case NET_PACKET_STORE_ANNOUNCE_REQUEST:\n+            return NET_PACKET_STORE_ANNOUNCE_RESPONSE;\n+\n+        default: {\n+            assert(false);\n+            return NET_PACKET_MAX;\n+        }\n+    }\n+}\n+\n+typedef struct Announce_Entry {\n+    uint64_t store_until;\n+    uint8_t data_public_key[CRYPTO_PUBLIC_KEY_SIZE];\n+    uint8_t *data;\n+    uint32_t length;\n+} Announce_Entry;\n+\n+struct Announcements {\n+    const Logger *log;\n+    const Random *rng;\n+    Forwarding *forwarding;\n+    const Mono_Time *mono_time;\n+    DHT *dht;\n+    Networking_Core *net;\n+    const uint8_t *public_key;\n+    const uint8_t *secret_key;\n+\n+    Shared_Keys shared_keys;\n+    uint8_t hmac_key[CRYPTO_HMAC_KEY_SIZE];\n+\n+    int32_t synch_offset;\n+\n+    uint64_t start_time;\n+\n+    Announce_Entry entries[ANNOUNCE_BUCKETS * ANNOUNCE_BUCKET_SIZE];\n+};\n+\n+void set_synch_offset(Announcements *announce, int32_t synch_offset)\n+{\n+    announce->synch_offset = synch_offset;\n+}\n+\n+/**\n+ * An entry is considered to be \"deleted\" for the purposes of the protocol\n+ * once it has timed out.\n+ */\n+non_null()\n+static bool entry_is_empty(const Announcements *announce, const Announce_Entry *entry)\n+{\n+    return mono_time_get(announce->mono_time) >= entry->store_until;\n+}\n+\n+non_null()\n+static void delete_entry(Announce_Entry *entry)\n+{\n+    entry->store_until = 0;\n+}\n+\n+/** Return bits (at most 8) from pk starting at index as uint8_t */\n+non_null()\n+static uint8_t truncate_pk_at_index(const uint8_t *pk, uint16_t index, uint16_t bits)\n+{\n+    assert(bits < 8);\n+    const uint8_t i = index / 8;\n+    const uint8_t j = index % 8;\n+    return ((uint8_t)((i < CRYPTO_PUBLIC_KEY_SIZE ? pk[i] : 0) << j) >> (8 - bits)) |\n+           ((i + 1 < CRYPTO_PUBLIC_KEY_SIZE ? pk[i + 1] : 0) >> (16 - bits - j));\n+}\n+\n+uint16_t get_bucketnum(const uint8_t *base, const uint8_t *pk)\n+{\n+    const uint16_t index = bit_by_bit_cmp(base, pk);\n+\n+    return truncate_pk_at_index(base, index + 1, ANNOUNCE_BUCKET_PREFIX_LENGTH) ^\n+           truncate_pk_at_index(pk, index + 1, ANNOUNCE_BUCKET_PREFIX_LENGTH);\n+}\n+\n+non_null()\n+static Announce_Entry *bucket_of_key(Announcements *announce, const uint8_t *pk)\n+{\n+    return &announce->entries[get_bucketnum(announce->public_key, pk) * ANNOUNCE_BUCKET_SIZE];\n+}\n+\n+non_null()\n+static Announce_Entry *get_stored(Announcements *announce, const uint8_t *data_public_key)\n+{\n+    Announce_Entry *const bucket = bucket_of_key(announce, data_public_key);\n+\n+    for (uint32_t i = 0; i < ANNOUNCE_BUCKET_SIZE; ++i) {\n+        if (pk_equal(bucket[i].data_public_key, data_public_key)) {\n+            if (entry_is_empty(announce, &bucket[i])) {\n+                break;\n+            }\n+\n+            return &bucket[i];\n+        }\n+    }\n+\n+    return nullptr;\n+}\n+\n+non_null()\n+static const Announce_Entry *bucket_of_key_const(const Announcements *announce, const uint8_t *pk)\n+{\n+    return &announce->entries[get_bucketnum(announce->public_key, pk) * ANNOUNCE_BUCKET_SIZE];\n+}\n+\n+non_null()\n+static const Announce_Entry *get_stored_const(const Announcements *announce, const uint8_t *data_public_key)\n+{\n+    const Announce_Entry *const bucket = bucket_of_key_const(announce, data_public_key);\n+\n+    for (uint32_t i = 0; i < ANNOUNCE_BUCKET_SIZE; ++i) {\n+        if (pk_equal(bucket[i].data_public_key, data_public_key)) {\n+            if (entry_is_empty(announce, &bucket[i])) {\n+                break;\n+            }\n+\n+            return &bucket[i];\n+        }\n+    }\n+\n+    return nullptr;\n+}\n+\n+\n+bool on_stored(const Announcements *announce, const uint8_t *data_public_key,\n+               on_retrieve_cb *on_retrieve_callback, void *object)\n+{\n+    const Announce_Entry *const entry = get_stored_const(announce, data_public_key);\n+\n+    if (entry == nullptr || entry->data == nullptr) {\n+        return false;\n+    }\n+\n+    if (on_retrieve_callback != nullptr) {\n+        on_retrieve_callback(object, entry->data, entry->length);\n+    }\n+\n+    return true;\n+}\n+\n+/**\n+ * Return existing entry for this key if it exists, else an empty\n+ * slot in the key's bucket if one exists, else an entry in the key's bucket\n+ * of greatest 2-adic distance greater than that of the key bucket if one\n+ * exists, else nullptr.\n+ */\n+non_null()\n+static Announce_Entry *find_entry_slot(Announcements *announce, const uint8_t *data_public_key)\n+{\n+    Announce_Entry *const bucket = bucket_of_key(announce, data_public_key);\n+\n+    Announce_Entry *slot = nullptr;\n+    uint16_t min_index = bit_by_bit_cmp(announce->public_key, data_public_key);\n+\n+    for (uint32_t i = 0; i < ANNOUNCE_BUCKET_SIZE; ++i) {\n+        if (pk_equal(bucket[i].data_public_key, data_public_key)) {\n+            return &bucket[i];\n+        }\n+\n+        if (entry_is_empty(announce, &bucket[i])) {\n+            slot = &bucket[i];\n+            min_index = 0;\n+            continue;\n+        }\n+\n+        const uint16_t index = bit_by_bit_cmp(announce->public_key, bucket[i].data_public_key);\n+\n+        if (index < min_index) {\n+            slot = &bucket[i];\n+            min_index = index;\n+        }\n+    }\n+\n+    return slot;\n+}\n+\n+non_null()\n+static bool would_accept_store_request(Announcements *announce, const uint8_t *data_public_key)\n+{\n+    return find_entry_slot(announce, data_public_key) != nullptr;\n+}\n+\n+bool store_data(Announcements *announce, const uint8_t *data_public_key,\n+                const uint8_t *data, uint32_t length, uint32_t timeout)\n+{\n+    if (length > MAX_ANNOUNCEMENT_SIZE) {\n+        return false;\n+    }\n+\n+    Announce_Entry *entry = find_entry_slot(announce, data_public_key);\n+\n+    if (entry == nullptr) {\n+        return false;\n+    }\n+\n+    if (length > 0) {\n+        assert(data != nullptr);\n+\n+        if (entry->data != nullptr) {\n+            free(entry->data);\n+        }\n+\n+        entry->data = (uint8_t *)malloc(length);\n+\n+        if (entry->data == nullptr) {\n+            return false;\n+        }\n+\n+        memcpy(entry->data, data, length);\n+    }\n+\n+    entry->length = length;\n+    memcpy(entry->data_public_key, data_public_key, CRYPTO_PUBLIC_KEY_SIZE);\n+    entry->store_until = mono_time_get(announce->mono_time) + timeout;\n+\n+    return true;\n+}\n+\n+non_null()\n+static uint32_t calculate_timeout(const Announcements *announce, uint32_t requested_timeout)\n+{\n+    const uint64_t uptime = mono_time_get(announce->mono_time) - announce->start_time;\n+    const uint32_t max_announcement_timeout = max_u32(\n+                (uint32_t)min_u64(\n+                    MAX_MAX_ANNOUNCEMENT_TIMEOUT,\n+                    uptime / MAX_ANNOUNCEMENT_TIMEOUT_UPTIME_RATIO),\n+                MIN_MAX_ANNOUNCEMENT_TIMEOUT);\n+\n+    return min_u32(max_announcement_timeout, requested_timeout);\n+}\n+\n+#define DATA_SEARCH_TO_AUTH_MAX_SIZE (CRYPTO_PUBLIC_KEY_SIZE * 2 + MAX_PACKED_IPPORT_SIZE + MAX_SENDBACK_SIZE)\n+\n+non_null(1, 2, 3, 4, 7) nullable(5)\n+static int create_data_search_to_auth(const Logger *logger, const uint8_t *data_public_key,\n+                                      const uint8_t *requester_key,\n+                                      const IP_Port *source, const uint8_t *sendback, uint16_t sendback_length,\n+                                      uint8_t *dest, uint16_t max_length)\n+{\n+    if (max_length < DATA_SEARCH_TO_AUTH_MAX_SIZE) {\n+        return -1;\n+    }\n+\n+    memcpy(dest, data_public_key, CRYPTO_PUBLIC_KEY_SIZE);\n+    memcpy(dest + CRYPTO_PUBLIC_KEY_SIZE, requester_key, CRYPTO_PUBLIC_KEY_SIZE);\n+\n+    const int ipport_length = pack_ip_port(logger, dest + CRYPTO_PUBLIC_KEY_SIZE * 2, MAX_PACKED_IPPORT_SIZE, source);\n+\n+    if (ipport_length == -1) {\n+        return -1;\n+    }\n+\n+    if (sendback_length > 0) {\n+        assert(sendback != nullptr);\n+        memcpy(dest + CRYPTO_PUBLIC_KEY_SIZE * 2 + ipport_length, sendback, sendback_length);\n+    }\n+\n+    return CRYPTO_PUBLIC_KEY_SIZE * 2 + ipport_length + sendback_length;\n+}\n+\n+#define DATA_SEARCH_TIMEOUT 60\n+\n+non_null(1, 2, 3, 7, 9) nullable(5)\n+static int create_reply_plain(Announcements *announce,\n+                              const uint8_t *requester_key, const IP_Port *source, uint8_t type,\n+                              const uint8_t *sendback, uint16_t sendback_length,\n+                              const uint8_t *data, uint16_t length,\n+                              uint8_t *reply, uint16_t reply_max_length)\n+{\n+    if (length < CRYPTO_PUBLIC_KEY_SIZE) {\n+        return -1;\n+    }\n+\n+    const uint8_t *const data_public_key = data;\n+\n+    uint8_t to_auth[DATA_SEARCH_TO_AUTH_MAX_SIZE];\n+    const int to_auth_length = create_data_search_to_auth(announce->log, data_public_key, requester_key, source,\n+                               sendback, sendback_length, to_auth, DATA_SEARCH_TO_AUTH_MAX_SIZE);\n+\n+    if (to_auth_length == -1) {\n+        return -1;\n+    }\n+\n+    if (type == NET_PACKET_DATA_SEARCH_REQUEST) {",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841074205",
            "id": 841074205,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4yIcYd",
            "original_commit_id": "c49139ccbbf1ab44b1dd47a150ba91171e9ff1c4",
            "original_line": 314,
            "original_position": 314,
            "original_start_line": null,
            "path": "toxcore/announce.c",
            "position": null,
            "pull_request_review_id": 929569002,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841074205/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-04-02T13:03:00Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841074205",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841123971"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841123971"
                }
            },
            "author_association": "MEMBER",
            "body": "Maybe remove this.\r\n\r\nISO/IEC 9899:1999 (E) 6.5.3.4p3:\r\n> When applied to an operand that has type char, unsigned char, or signed char, (or a qualified version thereof) the result is 1.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-04-02T22:01:19Z",
            "diff_hunk": "@@ -0,0 +1,326 @@\n+#include <assert.h>\n+#include <stdlib.h>\n+#include <string.h>\n+\n+#include \"../toxcore/tox.h\"\n+#include \"../toxcore/announce.h\"\n+#include \"../testing/misc_tools.h\"\n+#include \"../toxcore/mono_time.h\"\n+#include \"../toxcore/forwarding.h\"\n+#include \"../toxcore/net_crypto.h\"\n+#include \"../toxcore/util.h\"\n+#include \"auto_test_support.h\"\n+#include \"check_compat.h\"\n+\n+#ifndef USE_IPV6\n+#define USE_IPV6 1\n+#endif\n+\n+static inline IP get_loopback(void)\n+{\n+    IP ip;\n+#if USE_IPV6\n+    ip.family = net_family_ipv6;\n+    ip.ip.v6 = get_ip6_loopback();\n+#else\n+    ip.family = net_family_ipv4;\n+    ip.ip.v4 = get_ip4_loopback();\n+#endif\n+    return ip;\n+}\n+\n+#define NUM_FORWARDER 20\n+#define NUM_FORWARDER_TCP 5\n+#define NUM_FORWARDER_DHT (NUM_FORWARDER - NUM_FORWARDER_TCP)\n+#define NUM_FORWARDING_ITERATIONS 1\n+#define FORWARD_SEND_INTERVAL 2\n+#define FORWARDER_TCP_RELAY_PORT 36570\n+#define FORWARDING_BASE_PORT 36571\n+\n+typedef struct Test_Data {\n+    Networking_Core *net;\n+    uint32_t send_back;\n+    uint64_t sent;\n+    bool returned;\n+} Test_Data;\n+\n+static void test_forwarded_request_cb(void *object, const IP_Port *forwarder,\n+                                      const uint8_t *sendback, uint16_t sendback_length,\n+                                      const uint8_t *data, uint16_t length, void *userdata)\n+{\n+    Test_Data *test_data = (Test_Data *)object;\n+    uint8_t *index = (uint8_t *)userdata;\n+\n+    if (length != 12 || memcmp(\"hello:  \", data, 8) != 0) {\n+        printf(\"[%u] got unexpected data of length %d\\n\", *index, length);\n+        return;\n+    }\n+\n+    uint8_t reply[12];\n+    memcpy(reply, \"reply:  \", 8);\n+    memcpy(reply + 8, data + 8, 4);\n+    ck_assert_msg(forward_reply(test_data->net, forwarder, sendback, sendback_length, reply, 12),\n+                  \"[%u] forward_reply failed\", *index);\n+}\n+\n+static void test_forwarded_response_cb(void *object,\n+                                       const uint8_t *data, uint16_t length, void *userdata)\n+{\n+    Test_Data *test_data = (Test_Data *)object;\n+    uint8_t *index = (uint8_t *)userdata;\n+\n+    if (length != 12 || memcmp(\"reply:  \", data, 8) != 0) {\n+        printf(\"[%u] got unexpected data of length %d\\n\", *index, length);\n+        return;\n+    }\n+\n+    uint32_t send_back;\n+    net_unpack_u32(data + 8, &send_back);\n+\n+    if (test_data->send_back == send_back) {\n+        test_data->returned = true;\n+    }\n+}\n+\n+static bool all_returned(Test_Data *test_data)\n+{\n+    for (uint32_t i = 0; i < NUM_FORWARDER; ++i) {\n+        if (!test_data[i].returned) {\n+            return false;\n+        }\n+    }\n+\n+    return true;\n+}\n+\n+typedef struct Forwarding_Subtox {\n+    Logger *log;\n+    Mono_Time *mono_time;\n+    Networking_Core *net;\n+    DHT *dht;\n+    Net_Crypto *c;\n+    Forwarding *forwarding;\n+    Announcements *announce;\n+} Forwarding_Subtox;\n+\n+static Forwarding_Subtox *new_forwarding_subtox(bool no_udp, uint32_t *index, uint16_t port)\n+{\n+    Forwarding_Subtox *subtox = (Forwarding_Subtox *)calloc(1, sizeof(Forwarding_Subtox));\n+    ck_assert(subtox != nullptr);\n+\n+    subtox->log = logger_new();\n+    ck_assert(subtox->log != nullptr);\n+    logger_callback_log(subtox->log, (logger_cb *)print_debug_log, nullptr, index);\n+    subtox->mono_time = mono_time_new();\n+\n+    const Random *rng= system_random();\n+    ck_assert(rng != nullptr);\n+    const Network *ns = system_network();\n+    ck_assert(ns != nullptr);\n+\n+    if (no_udp) {\n+        subtox->net = new_networking_no_udp(subtox->log, ns);\n+    } else {\n+        const IP ip = get_loopback();\n+        subtox->net = new_networking_ex(subtox->log, ns, &ip, port, port, nullptr);\n+    }\n+\n+    subtox->dht = new_dht(subtox->log, rng, ns, subtox->mono_time, subtox->net, true, true);\n+\n+    const TCP_Proxy_Info inf = {{{{0}}}};\n+    subtox->c = new_net_crypto(subtox->log, rng, ns, subtox->mono_time, subtox->dht, &inf);\n+\n+    subtox->forwarding = new_forwarding(subtox->log, rng, subtox->mono_time, subtox->dht);\n+    ck_assert(subtox->forwarding != nullptr);\n+\n+    subtox->announce = new_announcements(subtox->log, rng, subtox->mono_time, subtox->forwarding);\n+    ck_assert(subtox->announce != nullptr);\n+\n+    return subtox;\n+}\n+\n+static void kill_forwarding_subtox(Forwarding_Subtox *subtox)\n+{\n+    kill_announcements(subtox->announce);\n+    kill_forwarding(subtox->forwarding);\n+    kill_net_crypto(subtox->c);\n+    kill_dht(subtox->dht);\n+    kill_networking(subtox->net);\n+    mono_time_free(subtox->mono_time);\n+    logger_kill(subtox->log);\n+    free(subtox);\n+}\n+\n+static void test_forwarding(void)\n+{\n+    assert(sizeof(char) == 1);",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841123971",
            "id": 841123971,
            "line": null,
            "node_id": "PRRC_kwDOA7zIGs4yIoiD",
            "original_commit_id": "005d712196f899505acdfd1bfa6f0d4abf548e30",
            "original_line": 156,
            "original_position": 156,
            "original_start_line": null,
            "path": "auto_tests/forwarding_test.c",
            "position": null,
            "pull_request_review_id": 929607854,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841123971/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-04-02T22:01:29Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841123971",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        },
        {
            "_links": {
                "html": {
                    "href": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841211364"
                },
                "pull_request": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147"
                },
                "self": {
                    "href": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841211364"
                }
            },
            "author_association": "MEMBER",
            "body": "Can you document the parameters? What kind of key is `key`? Where do you get one from?\r\n\r\nWhat is `auth`? Most of the time, given a parameter like `public_key`, you can find a `PUBLIC_KEY_SIZE` somewhere nearby, but there's no `AUTH_SIZE` (there is a `HMAC_SIZE`, maybe this should be called `hmac`?). Better yet: put `uint8_t hmac[CRYPTO_HMAC_SIZE]`, or if you want you can keep the name `auth` with explicit size.",
            "commit_id": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "created_at": "2022-04-03T11:56:07Z",
            "diff_hunk": "@@ -147,6 +157,18 @@ void crypto_sha256(uint8_t *hash, const uint8_t *data, size_t length);\n non_null()\n void crypto_sha512(uint8_t *hash, const uint8_t *data, size_t length);\n \n+/**\n+ * @brief Compute an HMAC authenticator (32 bytes).",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#discussion_r841211364",
            "id": 841211364,
            "line": 161,
            "node_id": "PRRC_kwDOA7zIGs4yI93k",
            "original_commit_id": "f7da2e2be2f0400d84bba8a6c708821a2b5bafb1",
            "original_line": 161,
            "original_position": 22,
            "original_start_line": null,
            "path": "toxcore/crypto_core.h",
            "position": 22,
            "pull_request_review_id": 929664339,
            "pull_request_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841211364/reactions"
            },
            "side": "RIGHT",
            "start_line": null,
            "start_side": null,
            "subject_type": "line",
            "updated_at": "2022-04-03T11:56:13Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments/841211364",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            }
        }
    ],
    "comment_regular_data": [
        {
            "author_association": "NONE",
            "body": "# [Codecov](https://codecov.io/gh/TokTok/c-toxcore/pull/2147?src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok) Report\n> Merging [#2147](https://codecov.io/gh/TokTok/c-toxcore/pull/2147?src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok) (e49a477) into [master](https://codecov.io/gh/TokTok/c-toxcore/commit/dec1399776fcd1a89d78588b77ddd1c44a9bf635?el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok) (dec1399) will **increase** coverage by `0.06%`.\n> The diff coverage is `81.67%`.\n\n```diff\n@@            Coverage Diff             @@\n##           master    #2147      +/-   ##\n==========================================\n+ Coverage   78.49%   78.56%   +0.06%     \n==========================================\n  Files         120      125       +5     \n  Lines       22671    23583     +912     \n==========================================\n+ Hits        17796    18527     +731     \n- Misses       4875     5056     +181     \n```\n\n\n| [Impacted Files](https://codecov.io/gh/TokTok/c-toxcore/pull/2147?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok) | Coverage Δ | |\n|---|---|---|\n| [other/DHT\\_bootstrap.c](https://codecov.io/gh/TokTok/c-toxcore/pull/2147/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok#diff-b3RoZXIvREhUX2Jvb3RzdHJhcC5j) | `0.00% <0.00%> (ø)` | |\n| [toxcore/announce.c](https://codecov.io/gh/TokTok/c-toxcore/pull/2147/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok#diff-dG94Y29yZS9hbm5vdW5jZS5j) | `58.38% <58.38%> (ø)` | |\n| [toxcore/Messenger.c](https://codecov.io/gh/TokTok/c-toxcore/pull/2147/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok#diff-dG94Y29yZS9NZXNzZW5nZXIuYw==) | `82.90% <73.33%> (-0.13%)` | :arrow_down: |\n| [toxcore/crypto\\_core.c](https://codecov.io/gh/TokTok/c-toxcore/pull/2147/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok#diff-dG94Y29yZS9jcnlwdG9fY29yZS5j) | `92.72% <75.00%> (-0.91%)` | :arrow_down: |\n| [toxcore/onion\\_client.c](https://codecov.io/gh/TokTok/c-toxcore/pull/2147/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok#diff-dG94Y29yZS9vbmlvbl9jbGllbnQuYw==) | `90.80% <83.33%> (+0.11%)` | :arrow_up: |\n| [toxcore/TCP\\_server.c](https://codecov.io/gh/TokTok/c-toxcore/pull/2147/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok#diff-dG94Y29yZS9UQ1Bfc2VydmVyLmM=) | `78.58% <85.45%> (+0.33%)` | :arrow_up: |\n| [toxcore/TCP\\_client.c](https://codecov.io/gh/TokTok/c-toxcore/pull/2147/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok#diff-dG94Y29yZS9UQ1BfY2xpZW50LmM=) | `83.84% <86.66%> (+0.10%)` | :arrow_up: |\n| [toxcore/forwarding.c](https://codecov.io/gh/TokTok/c-toxcore/pull/2147/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok#diff-dG94Y29yZS9mb3J3YXJkaW5nLmM=) | `87.50% <87.50%> (ø)` | |\n| [toxcore/DHT.c](https://codecov.io/gh/TokTok/c-toxcore/pull/2147/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok#diff-dG94Y29yZS9ESFQuYw==) | `83.39% <91.54%> (+0.33%)` | :arrow_up: |\n| [toxcore/TCP\\_connection.c](https://codecov.io/gh/TokTok/c-toxcore/pull/2147/diff?src=pr&el=tree&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok#diff-dG94Y29yZS9UQ1BfY29ubmVjdGlvbi5j) | `69.59% <92.50%> (+1.40%)` | :arrow_up: |\n| ... and [16 more](https://codecov.io/gh/TokTok/c-toxcore/pull/2147/diff?src=pr&el=tree-more&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok) | |\n\n------\n\n[Continue to review full report at Codecov](https://codecov.io/gh/TokTok/c-toxcore/pull/2147?src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok).\n> **Legend** - [Click here to learn more](https://docs.codecov.io/docs/codecov-delta?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok)\n> `Δ = absolute <relative> (impact)`, `ø = not affected`, `? = missing data`\n> Powered by [Codecov](https://codecov.io/gh/TokTok/c-toxcore/pull/2147?src=pr&el=footer&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok). Last update [dec1399...e49a477](https://codecov.io/gh/TokTok/c-toxcore/pull/2147?src=pr&el=lastupdated&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok). Read the [comment docs](https://docs.codecov.io/docs/pull-request-comments?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=TokTok).\n",
            "created_at": "2022-04-02T08:35:57Z",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#issuecomment-1086590429",
            "id": 1086590429,
            "issue_url": "https://api.github.com/repos/TokTok/c-toxcore/issues/2147",
            "node_id": "IC_kwDOA7zIGs5AxA3d",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/issues/comments/1086590429/reactions"
            },
            "updated_at": "2022-04-03T13:50:41Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/issues/comments/1086590429",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/in/254?v=4",
                "events_url": "https://api.github.com/users/codecov%5Bbot%5D/events{/privacy}",
                "followers_url": "https://api.github.com/users/codecov%5Bbot%5D/followers",
                "following_url": "https://api.github.com/users/codecov%5Bbot%5D/following{/other_user}",
                "gists_url": "https://api.github.com/users/codecov%5Bbot%5D/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/apps/codecov",
                "id": 22429695,
                "login": "codecov[bot]",
                "node_id": "MDM6Qm90MjI0Mjk2OTU=",
                "organizations_url": "https://api.github.com/users/codecov%5Bbot%5D/orgs",
                "received_events_url": "https://api.github.com/users/codecov%5Bbot%5D/received_events",
                "repos_url": "https://api.github.com/users/codecov%5Bbot%5D/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/codecov%5Bbot%5D/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/codecov%5Bbot%5D/subscriptions",
                "type": "Bot",
                "url": "https://api.github.com/users/codecov%5Bbot%5D",
                "user_view_type": "public"
            }
        },
        {
            "author_association": "MEMBER",
            "body": "Done.\n",
            "created_at": "2022-04-02T14:16:29Z",
            "html_url": "https://github.com/TokTok/c-toxcore/pull/2147#issuecomment-1086650043",
            "id": 1086650043,
            "issue_url": "https://api.github.com/repos/TokTok/c-toxcore/issues/2147",
            "node_id": "IC_kwDOA7zIGs5AxPa7",
            "performed_via_github_app": null,
            "reactions": {
                "+1": 0,
                "-1": 0,
                "confused": 0,
                "eyes": 0,
                "heart": 0,
                "hooray": 0,
                "laugh": 0,
                "rocket": 0,
                "total_count": 0,
                "url": "https://api.github.com/repos/TokTok/c-toxcore/issues/comments/1086650043/reactions"
            },
            "updated_at": "2022-04-02T14:16:29Z",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/issues/comments/1086650043",
            "user": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            }
        }
    ],
    "comments": 2,
    "comments_url": "https://api.github.com/repos/TokTok/c-toxcore/issues/2147/comments",
    "commit_data": [
        {
            "author": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            },
            "comments_url": "https://api.github.com/repos/TokTok/c-toxcore/commits/e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2/comments",
            "commit": {
                "author": {
                    "date": "2020-12-31T00:00:00Z",
                    "email": "mbays+tox@sdf.org",
                    "name": "zugz (tox)"
                },
                "comment_count": 0,
                "committer": {
                    "date": "2022-04-03T00:00:08Z",
                    "email": "mbays+tox@sdf.org",
                    "name": "zugz (tox)"
                },
                "message": "feat: add forwarding and announce request handling\n\nThis is the \"server-side\" part of the new friend finding system,\nallowing DHT nodes to store small amounts of data and permit searching\nfor it. A forwarding (proxying) mechanism allows this to be used by TCP\nclients, and deals with non-transitivity in the network.",
                "tree": {
                    "sha": "15b986611e295e892d6091d96df17e0a4741083c",
                    "url": "https://api.github.com/repos/TokTok/c-toxcore/git/trees/15b986611e295e892d6091d96df17e0a4741083c"
                },
                "url": "https://api.github.com/repos/TokTok/c-toxcore/git/commits/e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
                "verification": {
                    "payload": "tree 15b986611e295e892d6091d96df17e0a4741083c\nparent 97acb39c1fd4ec05421729295e969d762b63cd01\nauthor zugz (tox) <mbays+tox@sdf.org> 1609372800 +0000\ncommitter zugz (tox) <mbays+tox@sdf.org> 1648944008 +0000\n\nfeat: add forwarding and announce request handling\n\nThis is the \"server-side\" part of the new friend finding system,\nallowing DHT nodes to store small amounts of data and permit searching\nfor it. A forwarding (proxying) mechanism allows this to be used by TCP\nclients, and deals with non-transitivity in the network.\n",
                    "reason": "valid",
                    "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEEAqnhZrfTpeTogXGLbyvaKJ0E8kkFAmJI44gACgkQbyvaKJ0E\n8kly8gf+NCPI1Cuxr03FhiyxGxLvUK/Xp2pOkcxCGeVBIsVb5t7U5tF5WREaM3NB\n3/O2aYdq+hrgXrm8+iWHzDBJ1bEkLtW/qNJ9ZEHp5v37jFbN4IzdHp+eKG2I/3o/\ncHJRbHiX1s+WaDFc/KvBN4M2mgCuB6JCj2SarZj8cld4xiGQi5j6qYZpbuAAnpj2\nGFiWfuUJe/9NYh6lvVVj57o+86MI7UHEApxbfZ6i6RqP5pSEquaoFWPvN2dxeON5\nWRnP4p8Ke6RnTA+n2IjwhYgYZ/GhuVVb2uLj0jRYWAIlynMJrQby1gYra5kpD9rE\nbz0w8iV7FYdWJi5Dl5QskrW/oo6vHQ==\n=zQR7\n-----END PGP SIGNATURE-----",
                    "verified": true,
                    "verified_at": "2024-11-07T21:51:23Z"
                }
            },
            "committer": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            },
            "html_url": "https://github.com/TokTok/c-toxcore/commit/e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "node_id": "C_kwDOBLTK6NoAKGU0OWE0NzdhODQ1YmZhNWZhNWRhY2M3YzY1ZjhlMGJkMzgwOThjYjI",
            "parents": [
                {
                    "html_url": "https://github.com/TokTok/c-toxcore/commit/97acb39c1fd4ec05421729295e969d762b63cd01",
                    "sha": "97acb39c1fd4ec05421729295e969d762b63cd01",
                    "url": "https://api.github.com/repos/TokTok/c-toxcore/commits/97acb39c1fd4ec05421729295e969d762b63cd01"
                }
            ],
            "sha": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/commits/e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2"
        },
        {
            "author": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            },
            "comments_url": "https://api.github.com/repos/TokTok/c-toxcore/commits/7cee48d9c44ddd4ed8b5a9e1a8d81c91bc65ae69/comments",
            "commit": {
                "author": {
                    "date": "2019-08-16T00:00:00Z",
                    "email": "mbays+tox@sdf.org",
                    "name": "zugz (tox)"
                },
                "comment_count": 0,
                "committer": {
                    "date": "2022-04-03T11:41:42Z",
                    "email": "iphydf@users.noreply.github.com",
                    "name": "iphydf"
                },
                "message": "cleanup: clarify and isolate use of custom IP_Port values to denote TCP connections",
                "tree": {
                    "sha": "709e81ec6dc148bd882440c1ca56e1d5c3bd2832",
                    "url": "https://api.github.com/repos/TokTok/c-toxcore/git/trees/709e81ec6dc148bd882440c1ca56e1d5c3bd2832"
                },
                "url": "https://api.github.com/repos/TokTok/c-toxcore/git/commits/7cee48d9c44ddd4ed8b5a9e1a8d81c91bc65ae69",
                "verification": {
                    "payload": "tree 709e81ec6dc148bd882440c1ca56e1d5c3bd2832\nparent dec1399776fcd1a89d78588b77ddd1c44a9bf635\nauthor zugz (tox) <mbays+tox@sdf.org> 1565913600 +0000\ncommitter iphydf <iphydf@users.noreply.github.com> 1648986102 +0000\n\ncleanup: clarify and isolate use of custom IP_Port values to denote TCP connections\n",
                    "reason": "valid",
                    "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCgAdFiEEqQ4tlxH906HdaIgsOFXbotdEA8kFAmJJh/YACgkQOFXbotdE\nA8kswAgAjBgtfAc8kmSXY9AkdbQTf+fazB6NwGzsY1spdTR5D0crYFeDlEpIqlmK\nJZEnkv4tWE+/pGc6pXOSU4p3TrCN+1nWvZiTAy9pCuAkzoTOnHiYItWeht0foI0V\nx+W+0ea12eoHWwXoRpZq8W40omB3aXQT10SRG3jM1qJfcYhqt7qAbJt+/KSGRrju\nVwuxuGrAPm1SJ8ftNJCcguWUUN0XRl8cLrR7RtlhQtDf6gB2XiqByoEhWoZf2c9/\nUaVHxM3wEAGjZ5oEtHw9bxgNelWmL49HsdIgle3/mvYGRxZna7EHzyD20zsZU+fG\nY/CeTFpyKv56guea13abrTwkm7/dag==\n=MbhZ\n-----END PGP SIGNATURE-----",
                    "verified": true,
                    "verified_at": "2024-11-09T19:09:03Z"
                }
            },
            "committer": {
                "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
                "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
                "followers_url": "https://api.github.com/users/iphydf/followers",
                "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
                "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/iphydf",
                "id": 10647936,
                "login": "iphydf",
                "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
                "organizations_url": "https://api.github.com/users/iphydf/orgs",
                "received_events_url": "https://api.github.com/users/iphydf/received_events",
                "repos_url": "https://api.github.com/users/iphydf/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/iphydf",
                "user_view_type": "public"
            },
            "html_url": "https://github.com/TokTok/c-toxcore/commit/7cee48d9c44ddd4ed8b5a9e1a8d81c91bc65ae69",
            "node_id": "C_kwDOBLTK6NoAKDdjZWU0OGQ5YzQ0ZGRkNGVkOGI1YTllMWE4ZDgxYzkxYmM2NWFlNjk",
            "parents": [
                {
                    "html_url": "https://github.com/TokTok/c-toxcore/commit/dec1399776fcd1a89d78588b77ddd1c44a9bf635",
                    "sha": "dec1399776fcd1a89d78588b77ddd1c44a9bf635",
                    "url": "https://api.github.com/repos/TokTok/c-toxcore/commits/dec1399776fcd1a89d78588b77ddd1c44a9bf635"
                }
            ],
            "sha": "7cee48d9c44ddd4ed8b5a9e1a8d81c91bc65ae69",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/commits/7cee48d9c44ddd4ed8b5a9e1a8d81c91bc65ae69"
        },
        {
            "author": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            },
            "comments_url": "https://api.github.com/repos/TokTok/c-toxcore/commits/97acb39c1fd4ec05421729295e969d762b63cd01/comments",
            "commit": {
                "author": {
                    "date": "2019-09-07T00:00:01Z",
                    "email": "mbays+tox@sdf.org",
                    "name": "zugz (tox)"
                },
                "comment_count": 0,
                "committer": {
                    "date": "2022-04-03T00:00:08Z",
                    "email": "mbays+tox@sdf.org",
                    "name": "zugz (tox)"
                },
                "message": "cleanup: add timed_auth module for ping_ids",
                "tree": {
                    "sha": "c2532dd2f1c88348d0c6ecfc53a028022adfb2b5",
                    "url": "https://api.github.com/repos/TokTok/c-toxcore/git/trees/c2532dd2f1c88348d0c6ecfc53a028022adfb2b5"
                },
                "url": "https://api.github.com/repos/TokTok/c-toxcore/git/commits/97acb39c1fd4ec05421729295e969d762b63cd01",
                "verification": {
                    "payload": "tree c2532dd2f1c88348d0c6ecfc53a028022adfb2b5\nparent 7cee48d9c44ddd4ed8b5a9e1a8d81c91bc65ae69\nauthor zugz (tox) <mbays+tox@sdf.org> 1567814401 +0000\ncommitter zugz (tox) <mbays+tox@sdf.org> 1648944008 +0000\n\ncleanup: add timed_auth module for ping_ids\n",
                    "reason": "valid",
                    "signature": "-----BEGIN PGP SIGNATURE-----\n\niQEzBAABCAAdFiEEAqnhZrfTpeTogXGLbyvaKJ0E8kkFAmJI44gACgkQbyvaKJ0E\n8knuEwf/btVprw0PjRRrVGIuKlJzabmntXTbxZqHFJId7yP0foPcyj3DbX+JEzru\nnoEH60sKJYPxf4ZTZ3VLXUOB+F+D31jASSP8An9ATBKIvyCFa4jWPpEI/5aFIuaI\nWeFqK4oWIjpJhPsZjeGOxvTfxtawlpsFVwf5+rCutuRumyskMI88BCiwj4dOjSeX\nOw99O7doe2o8IDZm75YZlEE6Zyrn4hfmteS+U3dR3s9cKOBD+vLPlKU54HuVblBk\nLaGx8tSVFeQj3f+sLDeIqxUc+M23l3/x/hSd90mp0iNtxg0KEolapFv3bZVxkqUQ\nQSWg9Bcd8e5hxs9tyXvHx+UHbo7ILQ==\n=N5IW\n-----END PGP SIGNATURE-----",
                    "verified": true,
                    "verified_at": "2024-11-14T18:47:23Z"
                }
            },
            "committer": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            },
            "html_url": "https://github.com/TokTok/c-toxcore/commit/97acb39c1fd4ec05421729295e969d762b63cd01",
            "node_id": "C_kwDOBLTK6NoAKDk3YWNiMzljMWZkNGVjMDU0MjE3MjkyOTVlOTY5ZDc2MmI2M2NkMDE",
            "parents": [
                {
                    "html_url": "https://github.com/TokTok/c-toxcore/commit/7cee48d9c44ddd4ed8b5a9e1a8d81c91bc65ae69",
                    "sha": "7cee48d9c44ddd4ed8b5a9e1a8d81c91bc65ae69",
                    "url": "https://api.github.com/repos/TokTok/c-toxcore/commits/7cee48d9c44ddd4ed8b5a9e1a8d81c91bc65ae69"
                }
            ],
            "sha": "97acb39c1fd4ec05421729295e969d762b63cd01",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/commits/97acb39c1fd4ec05421729295e969d762b63cd01"
        }
    ],
    "commits": 3,
    "commits_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147/commits",
    "created_at": "2022-03-11T23:54:54Z",
    "deletions": 121,
    "diff_url": "https://github.com/TokTok/c-toxcore/pull/2147.diff",
    "draft": false,
    "head": {
        "label": "zugz:announce_store",
        "ref": "announce_store",
        "repo": {
            "allow_forking": true,
            "archive_url": "https://api.github.com/repos/zugz/c-toxcore/{archive_format}{/ref}",
            "archived": false,
            "assignees_url": "https://api.github.com/repos/zugz/c-toxcore/assignees{/user}",
            "blobs_url": "https://api.github.com/repos/zugz/c-toxcore/git/blobs{/sha}",
            "branches_url": "https://api.github.com/repos/zugz/c-toxcore/branches{/branch}",
            "clone_url": "https://github.com/zugz/c-toxcore.git",
            "collaborators_url": "https://api.github.com/repos/zugz/c-toxcore/collaborators{/collaborator}",
            "comments_url": "https://api.github.com/repos/zugz/c-toxcore/comments{/number}",
            "commits_url": "https://api.github.com/repos/zugz/c-toxcore/commits{/sha}",
            "compare_url": "https://api.github.com/repos/zugz/c-toxcore/compare/{base}...{head}",
            "contents_url": "https://api.github.com/repos/zugz/c-toxcore/contents/{+path}",
            "contributors_url": "https://api.github.com/repos/zugz/c-toxcore/contributors",
            "created_at": "2017-01-14T18:08:35Z",
            "default_branch": "master",
            "deployments_url": "https://api.github.com/repos/zugz/c-toxcore/deployments",
            "description": "The future of online communications.",
            "disabled": false,
            "downloads_url": "https://api.github.com/repos/zugz/c-toxcore/downloads",
            "events_url": "https://api.github.com/repos/zugz/c-toxcore/events",
            "fork": true,
            "forks": 0,
            "forks_count": 0,
            "forks_url": "https://api.github.com/repos/zugz/c-toxcore/forks",
            "full_name": "zugz/c-toxcore",
            "git_commits_url": "https://api.github.com/repos/zugz/c-toxcore/git/commits{/sha}",
            "git_refs_url": "https://api.github.com/repos/zugz/c-toxcore/git/refs{/sha}",
            "git_tags_url": "https://api.github.com/repos/zugz/c-toxcore/git/tags{/sha}",
            "git_url": "git://github.com/zugz/c-toxcore.git",
            "has_discussions": false,
            "has_downloads": true,
            "has_issues": false,
            "has_pages": false,
            "has_projects": true,
            "has_wiki": false,
            "homepage": "https://tox.chat/",
            "hooks_url": "https://api.github.com/repos/zugz/c-toxcore/hooks",
            "html_url": "https://github.com/zugz/c-toxcore",
            "id": 78957288,
            "is_template": false,
            "issue_comment_url": "https://api.github.com/repos/zugz/c-toxcore/issues/comments{/number}",
            "issue_events_url": "https://api.github.com/repos/zugz/c-toxcore/issues/events{/number}",
            "issues_url": "https://api.github.com/repos/zugz/c-toxcore/issues{/number}",
            "keys_url": "https://api.github.com/repos/zugz/c-toxcore/keys{/key_id}",
            "labels_url": "https://api.github.com/repos/zugz/c-toxcore/labels{/name}",
            "language": "C",
            "languages_url": "https://api.github.com/repos/zugz/c-toxcore/languages",
            "license": {
                "key": "gpl-3.0",
                "name": "GNU General Public License v3.0",
                "node_id": "MDc6TGljZW5zZTk=",
                "spdx_id": "GPL-3.0",
                "url": "https://api.github.com/licenses/gpl-3.0"
            },
            "merges_url": "https://api.github.com/repos/zugz/c-toxcore/merges",
            "milestones_url": "https://api.github.com/repos/zugz/c-toxcore/milestones{/number}",
            "mirror_url": null,
            "name": "c-toxcore",
            "node_id": "MDEwOlJlcG9zaXRvcnk3ODk1NzI4OA==",
            "notifications_url": "https://api.github.com/repos/zugz/c-toxcore/notifications{?since,all,participating}",
            "open_issues": 0,
            "open_issues_count": 0,
            "owner": {
                "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
                "events_url": "https://api.github.com/users/zugz/events{/privacy}",
                "followers_url": "https://api.github.com/users/zugz/followers",
                "following_url": "https://api.github.com/users/zugz/following{/other_user}",
                "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
                "gravatar_id": "",
                "html_url": "https://github.com/zugz",
                "id": 590069,
                "login": "zugz",
                "node_id": "MDQ6VXNlcjU5MDA2OQ==",
                "organizations_url": "https://api.github.com/users/zugz/orgs",
                "received_events_url": "https://api.github.com/users/zugz/received_events",
                "repos_url": "https://api.github.com/users/zugz/repos",
                "site_admin": false,
                "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
                "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
                "type": "User",
                "url": "https://api.github.com/users/zugz",
                "user_view_type": "public"
            },
            "private": false,
            "pulls_url": "https://api.github.com/repos/zugz/c-toxcore/pulls{/number}",
            "pushed_at": "2022-07-10T15:28:21Z",
            "releases_url": "https://api.github.com/repos/zugz/c-toxcore/releases{/id}",
            "size": 16881,
            "ssh_url": "git@github.com:zugz/c-toxcore.git",
            "stargazers_count": 1,
            "stargazers_url": "https://api.github.com/repos/zugz/c-toxcore/stargazers",
            "statuses_url": "https://api.github.com/repos/zugz/c-toxcore/statuses/{sha}",
            "subscribers_url": "https://api.github.com/repos/zugz/c-toxcore/subscribers",
            "subscription_url": "https://api.github.com/repos/zugz/c-toxcore/subscription",
            "svn_url": "https://github.com/zugz/c-toxcore",
            "tags_url": "https://api.github.com/repos/zugz/c-toxcore/tags",
            "teams_url": "https://api.github.com/repos/zugz/c-toxcore/teams",
            "topics": [],
            "trees_url": "https://api.github.com/repos/zugz/c-toxcore/git/trees{/sha}",
            "updated_at": "2020-04-26T16:00:08Z",
            "url": "https://api.github.com/repos/zugz/c-toxcore",
            "visibility": "public",
            "watchers": 1,
            "watchers_count": 1,
            "web_commit_signoff_required": false
        },
        "sha": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
        "user": {
            "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
            "events_url": "https://api.github.com/users/zugz/events{/privacy}",
            "followers_url": "https://api.github.com/users/zugz/followers",
            "following_url": "https://api.github.com/users/zugz/following{/other_user}",
            "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/zugz",
            "id": 590069,
            "login": "zugz",
            "node_id": "MDQ6VXNlcjU5MDA2OQ==",
            "organizations_url": "https://api.github.com/users/zugz/orgs",
            "received_events_url": "https://api.github.com/users/zugz/received_events",
            "repos_url": "https://api.github.com/users/zugz/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/zugz",
            "user_view_type": "public"
        }
    },
    "html_url": "https://github.com/TokTok/c-toxcore/pull/2147",
    "id": 877941580,
    "issue_url": "https://api.github.com/repos/TokTok/c-toxcore/issues/2147",
    "labels": [
        {
            "color": "84b6eb",
            "default": true,
            "description": "New feature for the user, not a new feature for build script",
            "id": 403702218,
            "name": "enhancement",
            "node_id": "MDU6TGFiZWw0MDM3MDIyMTg=",
            "url": "https://api.github.com/repos/TokTok/c-toxcore/labels/enhancement"
        }
    ],
    "locked": false,
    "maintainer_can_modify": false,
    "merge_commit_sha": "e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
    "mergeable": null,
    "mergeable_state": "unknown",
    "merged": true,
    "merged_at": "2022-04-03T13:59:59Z",
    "merged_by": {
        "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
        "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
        "followers_url": "https://api.github.com/users/iphydf/followers",
        "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
        "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/iphydf",
        "id": 10647936,
        "login": "iphydf",
        "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
        "organizations_url": "https://api.github.com/users/iphydf/orgs",
        "received_events_url": "https://api.github.com/users/iphydf/received_events",
        "repos_url": "https://api.github.com/users/iphydf/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/iphydf",
        "user_view_type": "public"
    },
    "milestone": {
        "closed_at": "2022-04-18T17:55:11Z",
        "closed_issues": 117,
        "created_at": "2022-02-23T23:17:57Z",
        "creator": {
            "avatar_url": "https://avatars.githubusercontent.com/u/10647936?v=4",
            "events_url": "https://api.github.com/users/iphydf/events{/privacy}",
            "followers_url": "https://api.github.com/users/iphydf/followers",
            "following_url": "https://api.github.com/users/iphydf/following{/other_user}",
            "gists_url": "https://api.github.com/users/iphydf/gists{/gist_id}",
            "gravatar_id": "",
            "html_url": "https://github.com/iphydf",
            "id": 10647936,
            "login": "iphydf",
            "node_id": "MDQ6VXNlcjEwNjQ3OTM2",
            "organizations_url": "https://api.github.com/users/iphydf/orgs",
            "received_events_url": "https://api.github.com/users/iphydf/received_events",
            "repos_url": "https://api.github.com/users/iphydf/repos",
            "site_admin": false,
            "starred_url": "https://api.github.com/users/iphydf/starred{/owner}{/repo}",
            "subscriptions_url": "https://api.github.com/users/iphydf/subscriptions",
            "type": "User",
            "url": "https://api.github.com/users/iphydf",
            "user_view_type": "public"
        },
        "description": "",
        "due_on": null,
        "html_url": "https://github.com/TokTok/c-toxcore/milestone/47",
        "id": 7708300,
        "labels_url": "https://api.github.com/repos/TokTok/c-toxcore/milestones/47/labels",
        "node_id": "MI_kwDOA7zIGs4AdZ6M",
        "number": 47,
        "open_issues": 0,
        "state": "closed",
        "title": "v0.2.18",
        "updated_at": "2023-11-13T15:43:59Z",
        "url": "https://api.github.com/repos/TokTok/c-toxcore/milestones/47"
    },
    "node_id": "PR_kwDOA7zIGs40VFNM",
    "number": 2147,
    "patch_url": "https://github.com/TokTok/c-toxcore/pull/2147.patch",
    "rebaseable": null,
    "requested_reviewers": [],
    "requested_teams": [],
    "review_comment_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/comments{/number}",
    "review_comments": 41,
    "review_comments_url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147/comments",
    "state": "closed",
    "statuses_url": "https://api.github.com/repos/TokTok/c-toxcore/statuses/e49a477a845bfa5fa5dacc7c65f8e0bd38098cb2",
    "title": "feat: Store announcements",
    "updated_at": "2022-04-03T14:00:00Z",
    "url": "https://api.github.com/repos/TokTok/c-toxcore/pulls/2147",
    "user": {
        "avatar_url": "https://avatars.githubusercontent.com/u/590069?v=4",
        "events_url": "https://api.github.com/users/zugz/events{/privacy}",
        "followers_url": "https://api.github.com/users/zugz/followers",
        "following_url": "https://api.github.com/users/zugz/following{/other_user}",
        "gists_url": "https://api.github.com/users/zugz/gists{/gist_id}",
        "gravatar_id": "",
        "html_url": "https://github.com/zugz",
        "id": 590069,
        "login": "zugz",
        "node_id": "MDQ6VXNlcjU5MDA2OQ==",
        "organizations_url": "https://api.github.com/users/zugz/orgs",
        "received_events_url": "https://api.github.com/users/zugz/received_events",
        "repos_url": "https://api.github.com/users/zugz/repos",
        "site_admin": false,
        "starred_url": "https://api.github.com/users/zugz/starred{/owner}{/repo}",
        "subscriptions_url": "https://api.github.com/users/zugz/subscriptions",
        "type": "User",
        "url": "https://api.github.com/users/zugz",
        "user_view_type": "public"
    }
}